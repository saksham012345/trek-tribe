services:
  mongo:
    image: mongo:6
    restart: unless-stopped
    ports:
      - '27017:27017'
    volumes:
      - mongo_data:/data/db
      
  api:
    build: ./services/api
    restart: unless-stopped
    environment:
      - MONGODB_URI=mongodb://mongo:27017/trektribe
      - NODE_ENV=development
      - PORT=4000
      # Provide a secure default for local/dev runs (must be >= 32 chars)
      - JWT_SECRET=a2f4b6c8d0e2f6a8b0c2d4e6f8a0b2c4d6e8f0a2b4c6d8e0f2a4b6c8d0e2f6
    ports:
      - '4000:4000'
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:4000/health || exit 1"]
      interval: 10s
      timeout: 5s
      retries: 5
      start_period: 10s
    depends_on:
      - mongo
      
  web:
    build: ./web
    restart: unless-stopped
    ports:
      - '3000:80'
    depends_on:
      - api
  # ai-service: (disabled) -- remove or enable if you add an `ai-service` folder
  #   build: ./ai-service
  #   restart: unless-stopped
  #   environment:
  #     - MODEL_NAME=${MODEL_NAME:-google/flan-t5-base}
  #     - MODEL_DIR=/app/models/${MODEL_NAME:-google_flan-t5-base}
  #     - AI_SERVICE_KEY=${AI_SERVICE_KEY:-dev-ai-key-123}
  #     - PORT=8000
  #   ports:
  #     - '8000:8000'
  #   volumes:
  #     - ./ai-service/data:/app/data:rw
  #     - ./ai-service/models:/app/models:rw
  #   depends_on:
  #     - api
      
volumes:
  mongo_data:

