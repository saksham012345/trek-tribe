  console.log
    [33mΓÜá∩╕Å  [2026-02-09T04:18:57.854Z] WARN: SMS service running in development mode only - OTPs will be logged instead of sent.[0m

      at Logger.log (src/utils/logger.ts:151:13)

  console.log
    [36mΓä╣∩╕Å  [2026-02-09T04:18:57.982Z] INFO: Razorpay Route service initialized[0m

      at Logger.log (src/utils/logger.ts:151:13)

  console.log
    [36mΓä╣∩╕Å  [2026-02-09T04:18:58.209Z] INFO: Trek Tribe AI initialized with advanced capabilities[0m

      at Logger.log (src/utils/logger.ts:151:13)

  console.log
    Γ£à Razorpay initialized for subscriptions

      at Object.<anonymous> (src/routes/subscriptions.ts:20:13)

  console.warn
    ΓÜá∩╕Å OpenAI API key not found. Using local TF-IDF fallback.

    [0m [90m 43 |[39m           console[33m.[39mlog([32m'Γä╣∩╕Å AI Offline Mode enabled. Using local TF-IDF fallback.'[39m)[33m;[39m
     [90m 44 |[39m         } [36melse[39m {
    [31m[1m>[22m[39m[90m 45 |[39m           console[33m.[39mwarn([32m'ΓÜá∩╕Å OpenAI API key not found. Using local TF-IDF fallback.'[39m)[33m;[39m
     [90m    |[39m                   [31m[1m^[22m[39m
     [90m 46 |[39m         }
     [90m 47 |[39m         [36mthis[39m[33m.[39minitializeTFIDFFallback()[33m;[39m
     [90m 48 |[39m       }[0m

      at EmbeddingService.initialize (src/services/embeddingService.ts:45:19)
      at new EmbeddingService (src/services/embeddingService.ts:26:10)
      at Object.<anonymous> (src/services/embeddingService.ts:350:33)
      at Object.<anonymous> (src/services/generalKnowledge.ts:1:1)
      at Object.<anonymous> (src/routes/ai.ts:14:1)
      at Object.<anonymous> (src/__tests__/comprehensive.test.ts:9:1)

  console.log
    ≡ƒôè TF-IDF fallback embedding service ready

      at EmbeddingService.initializeTFIDFFallback (src/services/embeddingService.ts:68:13)

  console.warn
    ΓÜá∩╕Å OpenAI API key not found. Using local TF-IDF fallback.

    [0m [90m 43 |[39m           console[33m.[39mlog([32m'Γä╣∩╕Å AI Offline Mode enabled. Using local TF-IDF fallback.'[39m)[33m;[39m
     [90m 44 |[39m         } [36melse[39m {
    [31m[1m>[22m[39m[90m 45 |[39m           console[33m.[39mwarn([32m'ΓÜá∩╕Å OpenAI API key not found. Using local TF-IDF fallback.'[39m)[33m;[39m
     [90m    |[39m                   [31m[1m^[22m[39m
     [90m 46 |[39m         }
     [90m 47 |[39m         [36mthis[39m[33m.[39minitializeTFIDFFallback()[33m;[39m
     [90m 48 |[39m       }[0m

      at EmbeddingService.initialize (src/services/embeddingService.ts:45:19)
      at new EmbeddingService (src/services/embeddingService.ts:26:10)
      at Object.<anonymous> (src/services/generalKnowledge.ts:95:16)
      at Object.<anonymous> (src/routes/ai.ts:14:1)
      at Object.<anonymous> (src/__tests__/comprehensive.test.ts:9:1)

  console.log
    ≡ƒôè TF-IDF fallback embedding service ready

      at EmbeddingService.initializeTFIDFFallback (src/services/embeddingService.ts:68:13)

  console.log
    Γ£à Using pure JavaScript embeddings (no native dependencies)

      at new TransformerEmbeddingService (src/services/transformerEmbeddings.ts:31:13)

  console.log
    Γä╣∩╕Å  [2026-02-09T04:19:00.400Z] INFO: Trek Tribe AI initialized with advanced capabilities

      at Object.<anonymous> (src/routes/ai.ts:1220:9)

  console.log
    ≡ƒÜÇ Initializing Knowledge Base...

      at KnowledgeBaseService.initialize (src/services/knowledgeBase.ts:344:13)

  console.log
    ≡ƒñû JavaScript embeddings service ready

      at TransformerEmbeddingService.initialize (src/services/transformerEmbeddings.ts:111:13)

  console.log
    Γ£à Transformer embeddings service initialized

      at KnowledgeBaseService.initialize (src/services/knowledgeBase.ts:348:13)

  console.log
    ≡ƒöä Refreshing knowledge base...

      at KnowledgeBaseService.refreshKnowledgeBase (src/services/knowledgeBase.ts:365:15)

  console.log
    ≡ƒöä Fetching trips from local DB...

      at DataFetcherService.fetchAllTrips (src/services/dataFetcher.ts:66:15)

node.exe : (node:20252) 
[MONGOOSE] Warning: 
Duplicate schema index on 
{"status":1} found. This is 
often due to declaring an 
index using both "index: 
true" and "schema.index()". 
Please remove the duplicate 
index definition.
At line:1 char:1
+ & "C:\Program 
Files\nodejs/node.exe" 
"C:\Program 
Files\nodejs/node_mo ...
+ ~~~~~~~~~~~~~~~~~~~~~~~~~~~
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
~~~~~~~~~~~~~
    + CategoryInfo           
   : NotSpecified: ((node:2  
  0252) [M...dex definitio   
 n.:String) [], RemoteExc    
eption
    + FullyQualifiedErrorId  
   : NativeCommandError
 
(Use `node --trace-warnings 
...` to show where the 
warning was created)
(node:20252) [MONGOOSE] 
Warning: Duplicate schema 
index on {"slug":1} found. 
This is often due to 
declaring an index using 
both "index: true" and 
"schema.index()". Please 
remove the duplicate index 
definition.
  console.log
    ≡ƒôé Upload directory exists: C:\Users\hp\Desktop\trektribe\trek-tribe\services\api\uploads

      at FileHandler.initializeUploadDirectory (src/utils/fileHandler.ts:75:15)

  console.log
    Γ£à Fetched 0 trips from database

      at DataFetcherService.fetchAllTrips (src/services/dataFetcher.ts:118:15)

  console.log
    ≡ƒöä Fetching organizers from local DB...

      at DataFetcherService.fetchAllOrganizers (src/services/dataFetcher.ts:130:15)

  console.log
    Γ£à Fetched 0 organizers from database

      at DataFetcherService.fetchAllOrganizers (src/services/dataFetcher.ts:152:15)

  console.log
    ≡ƒöä Generating embeddings using transformer model...

      at KnowledgeBaseService.generateEmbeddings (src/services/knowledgeBase.ts:448:13)

  console.log
    Γ£à Generated 41 transformer-based embeddings

      at KnowledgeBaseService.generateEmbeddings (src/services/knowledgeBase.ts:460:15)

  console.log
    Γ£à Generated 41 embeddings

      at KnowledgeBaseService.generateEmbeddings (src/services/knowledgeBase.ts:466:13)

  console.log
    Γ£à Knowledge base refreshed: 41 documents (0 trips, 0 organizers, 41 base docs)

      at KnowledgeBaseService.refreshKnowledgeBase (src/services/knowledgeBase.ts:411:15)

  console.log
    Γ£à Knowledge Base initialized with 41 documents

      at KnowledgeBaseService.initialize (src/services/knowledgeBase.ts:360:13)

  console.log
    [33mΓÜá∩╕Å  [2026-02-09T04:19:02.620Z] WARN: Email service not ready, skipping email verification OTP[0m

      at Logger.log (src/utils/logger.ts:151:13)

  console.log
    [36mΓä╣∩╕Å  [2026-02-09T04:19:02.624Z] INFO: Registration email OTP sent[0m
    {
      "email": "traveler@test.com",
      "userId": "69896036a38d1520226f1152",
      "role": "traveler"
    }

      at Logger.log (src/utils/logger.ts:151:13)

  console.log
    [36mΓä╣∩╕Å  [2026-02-09T04:19:02.920Z] INFO: Verification request created for new organizer[0m
    {
      "userId": "69896036a38d1520226f1177",
      "email": "organizer@test.com"
    }

      at Logger.log (src/utils/logger.ts:151:13)

  console.log
    [33mΓÜá∩╕Å  [2026-02-09T04:19:03.158Z] WARN: Email service not ready, skipping email verification OTP[0m

      at Logger.log (src/utils/logger.ts:151:13)

  console.log
    [36mΓä╣∩╕Å  [2026-02-09T04:19:03.159Z] INFO: Registration email OTP sent[0m
    {
      "email": "organizer@test.com",
      "userId": "69896036a38d1520226f1177",
      "role": "organizer"
    }

      at Logger.log (src/utils/logger.ts:151:13)

  console.log
    ≡ƒôÑ Received trip creation request: {
      title: 'Himalayan Adventure',
      destination: 'Manali, Himachal Pradesh',
      organizerId: '69896036a38d1520226f1177',
      role: 'organizer',
      price: 15000,
      capacity: 20,
      startDate: '2026-03-11T04:19:03.718Z',
      endDate: '2026-03-18T04:19:03.718Z',
      categories: undefined,
      hasImages: false,
      hasSchedule: false,
      hasPaymentConfig: false
    }

      at src/routes/trips.ts:60:13

  console.log
    Γ£à Validation successful with data transformation

      at src/routes/trips.ts:171:15

  console.log
    Creating trip: {
      title: 'Himalayan Adventure',
      organizerId: '69896036a38d1520226f1177',
      destination: 'Manali, Himachal Pradesh'
    }

      at src/routes/trips.ts:266:13

  console.log
    Γ£à Trip created successfully: new ObjectId('69896037a38d1520226f1188')

      at src/routes/trips.ts:303:13

  console.log
    ≡ƒôÑ Received trip creation request: {
      title: 'Incomplete Trip',
      destination: undefined,
      organizerId: '69896036a38d1520226f1177',
      role: 'organizer',
      price: undefined,
      capacity: undefined,
      startDate: undefined,
      endDate: undefined,
      categories: undefined,
      hasImages: false,
      hasSchedule: false,
      hasPaymentConfig: false
    }

      at src/routes/trips.ts:60:13

  console.log
    ≡ƒöì GET /trips - Query: { filter: { status: { '$in': [Array] } }, limit: 50 }

      at src/routes/trips.ts:541:13

  console.log
    Γ£à Found 1 trips

      at src/routes/trips.ts:549:13

  console.log
    ≡ƒöì GET /trips - Query: {
      filter: { status: { '$in': [Array] }, categories: 'trekking' },
      limit: 50
    }

      at src/routes/trips.ts:541:13

  console.log
    Γ£à Found 1 trips

      at src/routes/trips.ts:549:13

  console.log
    ≡ƒöì GET /trips - Query: {
      filter: {
        status: { '$in': [Array] },
        price: { '$gte': 10000, '$lte': 20000 }
      },
      limit: 50
    }

      at src/routes/trips.ts:541:13

  console.log
    Γ£à Found 1 trips

      at src/routes/trips.ts:549:13

  console.log
    Γ£à Trip activated for testing: 69896037a38d1520226f1188

      at Object.<anonymous> (src/__tests__/comprehensive.test.ts:296:17)

  console.log
    ≡ƒôÑ Received booking request: {
      tripId: '69896037a38d1520226f1188',
      numberOfTravelers: 2,
      contactPhone: undefined,
      hasSelectedPackage: false,
      hasTravelerDetails: true,
      travelerDetailsCount: 2,
      fullBody: {
        tripId: '69896037a38d1520226f1188',
        numberOfGuests: 2,
        participants: [ [Object], [Object] ],
        paymentMethod: 'online',
        specialRequests: 'Vegetarian food please',
        numberOfTravelers: 2,
        travelerDetails: [ [Object], [Object] ]
      }
    }

      at src/routes/bookings.ts:46:13

  console.log
    Γ£à Booking validation successful with data transformation

      at src/routes/bookings.ts:60:15

  console.log
    [36mΓä╣∩╕Å  [2026-02-09T04:19:03.867Z] INFO: New booking created with pending status[0m
    {
      "bookingId": "69896037a38d1520226f119e",
      "tripId": "69896037a38d1520226f1188",
      "userId": "69896036a38d1520226f1152",
      "numberOfTravelers": 2
    }

      at Logger.log (src/utils/logger.ts:151:13)

  console.log
    [33mΓÜá∩╕Å  [2026-02-09T04:19:03.868Z] WARN: ΓÜá∩╕Å  Email service not configured - skipping booking confirmation email[0m

      at Logger.log (src/utils/logger.ts:151:13)

  console.log
    [36mΓä╣∩╕Å  [2026-02-09T04:19:03.879Z] INFO: Auto-created lead from partial booking[0m
    {
      "leadId": "69896037a38d1520226f11a2",
      "userId": "69896036a38d1520226f1152",
      "tripId": "69896037a38d1520226f1188",
      "score": 80
    }

      at Logger.log (src/utils/logger.ts:151:13)

  console.log
    ≡ƒôÑ Received booking request: {
      tripId: '69896037a38d1520226f11a4',
      numberOfTravelers: 1,
      contactPhone: undefined,
      hasSelectedPackage: false,
      hasTravelerDetails: false,
      travelerDetailsCount: undefined,
      fullBody: {
        tripId: '69896037a38d1520226f11a4',
        numberOfGuests: 1,
        numberOfTravelers: 1
      }
    }

      at src/routes/bookings.ts:46:13

  console.log
    Γ£à Booking validation successful with data transformation

      at src/routes/bookings.ts:60:15

  console.log
    [36mΓä╣∩╕Å  [2026-02-09T04:19:03.887Z] INFO: Notified organizer of abandoned booking[0m
    {
      "organizerId": "69896036a38d1520226f1177",
      "leadId": "69896037a38d1520226f11a2"
    }

      at Logger.log (src/utils/logger.ts:151:13)

  console.log
    ≡ƒöì My bookings request (root): {
      userId: '69896036a38d1520226f1152',
      auth: {
        id: '69896036a38d1520226f1152',
        userId: '69896036a38d1520226f1152',
        role: 'traveler'
      }
    }

      at src/routes/bookings.ts:313:13

  console.error
    Authentication error: jwt malformed

    [0m [90m 118 |[39m     [36mreturn[39m next()[33m;[39m
     [90m 119 |[39m   } [36mcatch[39m (err) {
    [31m[1m>[22m[39m[90m 120 |[39m     console[33m.[39merror([32m'Authentication error:'[39m[33m,[39m err [36minstanceof[39m [33mError[39m [33m?[39m err[33m.[39mmessage [33m:[39m err)[33m;[39m
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 121 |[39m     [36mreturn[39m res[33m.[39mstatus([35m401[39m)[33m.[39mjson({ error[33m:[39m [32m'Invalid token'[39m })[33m;[39m
     [90m 122 |[39m   }
     [90m 123 |[39m }[0m

      at authenticateToken (src/middleware/auth.ts:120:13)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at next (node_modules/express/lib/router/route.js:149:13)
      at Route.dispatch (node_modules/express/lib/router/route.js:119:3)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at node_modules/express/lib/router/index.js:284:15
      at param (node_modules/express/lib/router/index.js:365:14)
      at param (node_modules/express/lib/router/index.js:376:14)
      at router.process_params (node_modules/express/lib/router/index.js:421:3)
      at next (node_modules/express/lib/router/index.js:280:10)
      at router.handle (node_modules/express/lib/router/index.js:175:3)
      at router (node_modules/express/lib/router/index.js:47:12)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at router.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at jsonParser (node_modules/body-parser/lib/types/json.js:113:7)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at router.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at expressInit (node_modules/express/lib/middleware/init.js:40:5)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at router.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at query (node_modules/express/lib/middleware/query.js:45:5)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at router.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at router.handle (node_modules/express/lib/router/index.js:175:3)
      at app.handle (node_modules/express/lib/application.js:181:10)
      at Server.app (node_modules/express/lib/express.js:39:9)

  console.log
    ≡ƒô¥ Audit log: CREATE Subscription by user 69896036a38d1520226f1177

      at AuditLogService.log (src/services/auditLogService.ts:63:15)

  console.log
    ≡ƒôì Follow-up detected: clarification Enhanced message: Tell me about adventure trips

      at src/routes/ai.ts:1412:15

  console.log
    ≡ƒôÑ Received booking request: {
      tripId: '69896037a38d1520226f1188',
      numberOfTravelers: 1,
      contactPhone: undefined,
      hasSelectedPackage: false,
      hasTravelerDetails: true,
      travelerDetailsCount: 1,
      fullBody: {
        tripId: '69896037a38d1520226f1188',
        numberOfGuests: 1,
        participants: [ [Object] ],
        paymentMethod: 'online',
        numberOfTravelers: 1,
        travelerDetails: [ [Object] ]
      }
    }

      at src/routes/bookings.ts:46:13

  console.log
    Γ£à Booking validation successful with data transformation

      at src/routes/bookings.ts:60:15

  console.log
    [36mΓä╣∩╕Å  [2026-02-09T04:19:04.053Z] INFO: New booking created with pending status[0m
    {
      "bookingId": "69896038a38d1520226f11df",
      "tripId": "69896037a38d1520226f1188",
      "userId": "69896036a38d1520226f1152",
      "numberOfTravelers": 1
    }

      at Logger.log (src/utils/logger.ts:151:13)

  console.log
    [33mΓÜá∩╕Å  [2026-02-09T04:19:04.054Z] WARN: ΓÜá∩╕Å  Email service not configured - skipping booking confirmation email[0m

      at Logger.log (src/utils/logger.ts:151:13)

  console.log
    [36mΓä╣∩╕Å  [2026-02-09T04:19:04.064Z] INFO: Updated lead from partial booking[0m
    {
      "leadId": "69896037a38d1520226f11a2",
      "userId": "69896036a38d1520226f1152",
      "tripId": "69896037a38d1520226f1188"
    }

      at Logger.log (src/utils/logger.ts:151:13)

  console.log
    ≡ƒöì Generating receipt for booking: {
      bookingId: '69896038a38d1520226f11df',
      userId: '69896036a38d1520226f1152',
      mainBookerId: new ObjectId('69896036a38d1520226f1152'),
      tripOrganizerId: new ObjectId('69896036a38d1520226f1177')
    }

      at src/routes/receipts.ts:217:13

  console.log
    ≡ƒôÑ Received booking request: {
      tripId: '69896037a38d1520226f1188',
      numberOfTravelers: 1,
      contactPhone: undefined,
      hasSelectedPackage: false,
      hasTravelerDetails: true,
      travelerDetailsCount: 1,
      fullBody: {
        tripId: '69896037a38d1520226f1188',
        numberOfGuests: 1,
        participants: [ [Object] ],
        numberOfTravelers: 1,
        travelerDetails: [ [Object] ]
      }
    }

      at src/routes/bookings.ts:46:13

  console.log
    Γ£à Booking validation successful with data transformation

      at src/routes/bookings.ts:60:15

  console.log
    [36mΓä╣∩╕Å  [2026-02-09T04:19:04.094Z] INFO: New booking created with pending status[0m
    {
      "bookingId": "69896038a38d1520226f11ee",
      "tripId": "69896037a38d1520226f1188",
      "userId": "69896036a38d1520226f1152",
      "numberOfTravelers": 1
    }

      at Logger.log (src/utils/logger.ts:151:13)

  console.log
    [33mΓÜá∩╕Å  [2026-02-09T04:19:04.095Z] WARN: ΓÜá∩╕Å  Email service not configured - skipping booking confirmation email[0m

      at Logger.log (src/utils/logger.ts:151:13)

  console.log
    [36mΓä╣∩╕Å  [2026-02-09T04:19:04.104Z] INFO: Updated lead from partial booking[0m
    {
      "leadId": "69896037a38d1520226f11a2",
      "userId": "69896036a38d1520226f1152",
      "tripId": "69896037a38d1520226f1188"
    }

      at Logger.log (src/utils/logger.ts:151:13)

  console.log
    ≡ƒöì Generating receipt for booking: {
      bookingId: '69896038a38d1520226f11ee',
      userId: '69896036a38d1520226f1152',
      mainBookerId: new ObjectId('69896036a38d1520226f1152'),
      tripOrganizerId: new ObjectId('69896036a38d1520226f1177')
    }

      at src/routes/receipts.ts:217:13

  console.log
    [36mΓä╣∩╕Å  [2026-02-09T04:19:04.217Z] INFO: Subscription receipt generated[0m
    {
      "subscriptionId": "69896037a38d1520226f11b8",
      "userId": "69896036a38d1520226f1177"
    }

      at Logger.log (src/utils/logger.ts:151:13)

  console.log
    ≡ƒöì GET /trips - Query: { filter: { status: 'active' }, limit: 50 }

      at src/routes/trips.ts:541:13

  console.log
    Γ£à Found 1 trips

      at src/routes/trips.ts:549:13

  console.log
    ≡ƒöì GET /trips - Query: { filter: { status: 'active', difficulty: 'moderate' }, limit: 50 }

      at src/routes/trips.ts:541:13

  console.log
    Γ£à Found 1 trips

      at src/routes/trips.ts:549:13

  console.log
    ≡ƒöì GET /trips - Query: { filter: { status: 'active' }, limit: 50 }

      at src/routes/trips.ts:541:13

  console.log
    Γ£à Found 1 trips

      at src/routes/trips.ts:549:13

  console.log
    ≡ƒöì GET /trips - Query: {
      filter: {
        status: 'active',
        categories: 'trekking',
        difficulty: 'moderate',
        price: { '$gte': 10000 }
      },
      limit: 50
    }

      at src/routes/trips.ts:541:13

  console.log
    Γ£à Found 1 trips

      at src/routes/trips.ts:549:13

  console.log
    ≡ƒôÑ Received trip creation request: {
      title: 'Invalid Trip',
      destination: 'Test',
      organizerId: '69896036a38d1520226f1177',
      role: 'organizer',
      price: 5000,
      capacity: undefined,
      startDate: '2026-02-08T04:19:04.275Z',
      endDate: '2026-02-09T04:19:04.276Z',
      categories: undefined,
      hasImages: false,
      hasSchedule: false,
      hasPaymentConfig: false
    }

      at src/routes/trips.ts:60:13

  console.error
    Γ¥î Validation failed in test mode: {
      formErrors: [],
      fieldErrors: {
        description: [ 'Required' ],
        capacity: [ 'Required' ],
        categories: [ 'Required' ]
      }
    }

    [0m [90m 172 |[39m     } [36mcatch[39m (error[33m:[39m any) {
     [90m 173 |[39m       [36mif[39m (process[33m.[39menv[33m.[39m[33mNODE_ENV[39m [33m===[39m [32m'test'[39m) {
    [31m[1m>[22m[39m[90m 174 |[39m         console[33m.[39merror([32m'Γ¥î Validation failed in test mode:'[39m[33m,[39m error[33m.[39mflatten [33m?[39m error[33m.[39mflatten() [33m:[39m error[33m.[39mmessage)[33m;[39m
     [90m     |[39m                 [31m[1m^[22m[39m
     [90m 175 |[39m         [36mreturn[39m res[33m.[39mstatus([35m400[39m)[33m.[39mjson({
     [90m 176 |[39m           error[33m:[39m [32m'Validation failed'[39m[33m,[39m
     [90m 177 |[39m           details[33m:[39m error[33m.[39mflatten [33m?[39m error[33m.[39mflatten()[33m.[39mfieldErrors [33m:[39m error[33m.[39mmessage[0m

      at src/routes/trips.ts:174:17
      at src/routes/trips.ts:51:19
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at next (node_modules/express/lib/router/route.js:149:13)
      at verifyOrganizerApproved (src/middleware/verifyOrganizer.ts:17:14)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at next (node_modules/express/lib/router/route.js:149:13)
      at requireEmailVerified (src/middleware/auth.ts:168:5)

  console.log
    ≡ƒôÑ Received booking request: {
      tripId: '69896037a38d1520226f1188',
      numberOfTravelers: 35,
      contactPhone: undefined,
      hasSelectedPackage: false,
      hasTravelerDetails: true,
      travelerDetailsCount: 0,
      fullBody: {
        tripId: '69896037a38d1520226f1188',
        numberOfGuests: 35,
        participants: [],
        numberOfTravelers: 35,
        travelerDetails: []
      }
    }

      at src/routes/bookings.ts:46:13

  console.log
    Γ£à Booking validation successful with data transformation

      at src/routes/bookings.ts:60:15

  console.log
    Γ¥î Not enough spots available: {
      availableSpots: 25,
      numberOfTravelers: 35,
      tripId: '69896037a38d1520226f1188'
    }

      at src/routes/bookings.ts:126:15

  console.log
    ≡ƒöì GET /trips - Query: { filter: { status: 'active' }, limit: 10 }

      at src/routes/trips.ts:541:13

  console.log
    Γ£à Found 1 trips

      at src/routes/trips.ts:549:13

  console.log
    [33mΓÜá∩╕Å  [2026-02-09T04:19:04.811Z] WARN: Email service not ready, skipping email verification OTP[0m

      at Logger.log (src/utils/logger.ts:151:13)

  console.log
    [36mΓä╣∩╕Å  [2026-02-09T04:19:04.811Z] INFO: Registration email OTP sent[0m
    {
      "email": "journey@test.com",
      "userId": "69896038a38d1520226f1216",
      "role": "traveler"
    }

      at Logger.log (src/utils/logger.ts:151:13)

  console.log
    ≡ƒöì GET /trips - Query: { filter: { status: { '$in': [Array] } }, limit: 50 }

      at src/routes/trips.ts:541:13

  console.log
    Γ£à Found 1 trips

      at src/routes/trips.ts:549:13

  console.log
    ≡ƒôÑ Received booking request: {
      tripId: '69896037a38d1520226f1188',
      numberOfTravelers: 1,
      contactPhone: undefined,
      hasSelectedPackage: false,
      hasTravelerDetails: true,
      travelerDetailsCount: 1,
      fullBody: {
        tripId: '69896037a38d1520226f1188',
        numberOfGuests: 1,
        participants: [ [Object] ],
        paymentMethod: 'online',
        numberOfTravelers: 1,
        travelerDetails: [ [Object] ]
      }
    }

      at src/routes/bookings.ts:46:13

  console.log
    Γ£à Booking validation successful with data transformation

      at src/routes/bookings.ts:60:15

  console.log
    [36mΓä╣∩╕Å  [2026-02-09T04:19:04.835Z] INFO: New booking created with pending status[0m
    {
      "bookingId": "69896038a38d1520226f1221",
      "tripId": "69896037a38d1520226f1188",
      "userId": "69896038a38d1520226f1216",
      "numberOfTravelers": 1
    }

      at Logger.log (src/utils/logger.ts:151:13)

  console.log
    [33mΓÜá∩╕Å  [2026-02-09T04:19:04.836Z] WARN: ΓÜá∩╕Å  Email service not configured - skipping booking confirmation email[0m

      at Logger.log (src/utils/logger.ts:151:13)

  console.log
    ≡ƒöì My bookings request (root): {
      userId: '69896038a38d1520226f1216',
      auth: {
        id: '69896038a38d1520226f1216',
        userId: '69896038a38d1520226f1216',
        role: 'traveler'
      }
    }

      at src/routes/bookings.ts:313:13

  console.log
    [36mΓä╣∩╕Å  [2026-02-09T04:19:04.848Z] INFO: Auto-created lead from partial booking[0m
    {
      "leadId": "69896038a38d1520226f1226",
      "userId": "69896038a38d1520226f1216",
      "tripId": "69896037a38d1520226f1188",
      "score": 80
    }

      at Logger.log (src/utils/logger.ts:151:13)

  console.log
    [36mΓä╣∩╕Å  [2026-02-09T04:19:04.854Z] INFO: Notified organizer of abandoned booking[0m
    {
      "organizerId": "69896036a38d1520226f1177",
      "leadId": "69896038a38d1520226f1226"
    }

      at Logger.log (src/utils/logger.ts:151:13)

  console.log
    [36mΓä╣∩╕Å  [2026-02-09T04:19:05.123Z] INFO: Verification request created for new organizer[0m
    {
      "userId": "69896039a38d1520226f122f",
      "email": "neworg@test.com"
    }

      at Logger.log (src/utils/logger.ts:151:13)

  console.log
    [33mΓÜá∩╕Å  [2026-02-09T04:19:05.370Z] WARN: Email service not ready, skipping email verification OTP[0m

      at Logger.log (src/utils/logger.ts:151:13)

  console.log
    [36mΓä╣∩╕Å  [2026-02-09T04:19:05.371Z] INFO: Registration email OTP sent[0m
    {
      "email": "neworg@test.com",
      "userId": "69896039a38d1520226f122f",
      "role": "organizer"
    }

      at Logger.log (src/utils/logger.ts:151:13)

  console.log
    ≡ƒô¥ Audit log: CREATE Subscription by user 69896039a38d1520226f122f

      at AuditLogService.log (src/services/auditLogService.ts:63:15)

  console.log
    ≡ƒôÑ Received trip creation request: {
      title: 'New Adventure',
      destination: 'Goa',
      organizerId: '69896039a38d1520226f122f',
      role: 'organizer',
      price: 8000,
      capacity: 15,
      startDate: '2026-03-11T04:19:05.385Z',
      endDate: '2026-03-16T04:19:05.385Z',
      categories: undefined,
      hasImages: false,
      hasSchedule: false,
      hasPaymentConfig: false
    }

      at src/routes/trips.ts:60:13

  console.log
    Γ£à Validation successful with data transformation

      at src/routes/trips.ts:171:15

  console.log
    Creating trip: {
      title: 'New Adventure',
      organizerId: '69896039a38d1520226f122f',
      destination: 'Goa'
    }

      at src/routes/trips.ts:266:13

  console.log
    Γ£à Trip created successfully: new ObjectId('69896039a38d1520226f1242')

      at src/routes/trips.ts:303:13

  console.log
    Γ£à Trip count incremented. Used: 1/4. Remaining: 3

      at src/routes/trips.ts:434:19

  console.log
    
        Γ£à Test Coverage Summary:
        - Authentication: Registration, Login, Token Validation
        - Trip Management: CRUD operations, Filters, Search
        - Booking System: Create, Read, Update, Cancel
        - Subscriptions: Plans, Trial, Eligibility
        - AI Features: Chat, Recommendations
        - Receipts: PDF Generation, Preview
        - Validation: Email, Phone, Dates, Capacity
        - Error Handling: 404, 400, 401, 403
        - Integration: Full user journeys

      at Object.<anonymous> (src/__tests__/comprehensive.test.ts:973:13)

FAIL src/__tests__/comprehens
ive.test.ts (13.906 s)
  ≡ƒº¬ Trek-Tribe 
Comprehensive Test Suite
    ≡ƒæñ Authentication & 
User Management
      POST /auth/register
        ΓêÜ should register 
a traveler successfully 
(1592 ms)
        ΓêÜ should register 
an organizer successfully 
(516 ms)
        ΓêÜ should reject 
registration with weak 
password (4 ms)
        ΓêÜ should reject 
duplicate email registration 
(3 ms)
      POST /auth/login
        ΓêÜ should login 
successfully with correct 
credentials (255 ms)
        ΓêÜ should reject 
login with wrong password 
(271 ms)
        ΓêÜ should reject 
login for non-existent user 
(6 ms)
      GET /auth/me
        ΓêÜ should return 
user profile with valid 
token (10 ms)
        ΓêÜ should reject 
request without token (4 ms)
    ≡ƒù║∩╕Å Trip Management
      POST /trips
        ΓêÜ should create a 
trip as organizer (36 ms)
        ΓêÜ should reject 
trip creation by traveler (5 
ms)
        ΓêÜ should reject 
trip with missing required 
fields (8 ms)
      GET /trips
        ΓêÜ should list all 
trips (24 ms)
        ΓêÜ should filter 
trips by category (8 ms)
        ΓêÜ should filter 
trips by price range (10 ms)
      GET /trips/:id
        ΓêÜ should get trip 
details by ID (7 ms)
        ΓêÜ should return 
404 for non-existent trip (5 
ms)
      PUT /trips/:id
        ΓêÜ should update 
trip as organizer (13 ms)
        ΓêÜ should activate 
trip for visibility (7 ms)
        ΓêÜ should reject 
update by non-owner (3 ms)
    ≡ƒôà Booking System
      POST 
/api/group-bookings
        ΓêÜ should create a 
booking as traveler (26 ms)
        ΓêÜ should reject 
booking without 
authentication (5 ms)
        ΓêÜ should reject 
booking with invalid trip ID 
(10 ms)
      GET /api/group-bookings
        ΓêÜ should list user 
bookings (9 ms)
      GET 
/api/group-bookings/:id
        ΓêÜ should get 
booking details (4 ms)
        ├ù should reject 
unauthorized access to 
booking (9 ms)
      PUT 
/api/group-bookings/:id
        ΓêÜ should update 
booking details (6 ms)
      DELETE 
/api/group-bookings/:id
        ΓêÜ should cancel 
booking (7 ms)
    ≡ƒÆ│ Subscription & 
Payment System
      GET 
/api/subscriptions/plans
        ΓêÜ should list 
available subscription plans 
(3 ms)
      GET 
/api/subscriptions/my
        ΓêÜ should check 
subscription status for 
organizer (7 ms)
        ΓêÜ should return 
401 without authentication 
(2 ms)
      POST /api/subscriptions
/create-order
        ΓêÜ should create 
trial subscription for new 
organizer (12 ms)
        ΓêÜ should reject 
subscription creation for 
non-organizer (3 ms)
      GET /api/subscriptions/
check-eligibility
        ΓêÜ should check 
trip posting eligibility (5 
ms)
    ≡ƒñû AI Features
      POST /api/ai/chat
        ΓêÜ should process 
AI chat query (45 ms)
        ΓêÜ should handle 
trip-specific queries (27 ms)
        ΓêÜ should reject 
empty messages (4 ms)
      GET 
/api/ai/recommendations
        ΓêÜ should get trip 
recommendations (7 ms)
    ≡ƒôä Receipt Generation
      GET /api/receipts/booki
ng/:bookingId/preview
        ΓêÜ should preview 
booking receipt data (21 ms)
        ΓêÜ should reject 
preview for unpaid booking 
(27 ms)
      GET /api/receipts/subsc
ription/:subscriptionId
        ΓêÜ should generate 
subscription receipt for 
paid subscription (110 ms)
        ΓêÜ should reject 
receipt for trial 
subscription (16 ms)
    ≡ƒöì Search & Filter
      GET /trips - Advanced 
Filters
        ΓêÜ should search 
trips by title (9 ms)
        ΓêÜ should filter by 
difficulty level (7 ms)
        ΓêÜ should filter by 
date range (7 ms)
        ΓêÜ should combine 
multiple filters (11 ms)
    Γ£à Validation & Error 
Handling
      ΓêÜ should validate 
email format (2 ms)
      ΓêÜ should validate 
phone number format (3 ms)
      ΓêÜ should validate 
trip dates (10 ms)
      ΓêÜ should validate 
booking capacity (14 ms)
      ΓêÜ should handle 404 
for non-existent resources 
(4 ms)
      ΓêÜ should handle 
malformed MongoDB IDs (2 ms)
    ΓÜí Performance & Limits
      ΓêÜ should handle 
large result sets with 
pagination (6 ms)
      ΓêÜ should reject 
excessively large file 
uploads
      ├ù should enforce trip 
posting limits for 
subscription (4 ms)
    ≡ƒöù End-to-End 
Integration
      ΓêÜ should complete 
full user journey: register 
ΓåÆ browse ΓåÆ book ΓåÆ pay 
(538 ms)
      ΓêÜ should complete 
organizer journey: register 
ΓåÆ subscribe ΓåÆ create 
trip (544 ms)
  ≡ƒôè Test Summary
    ΓêÜ should have 
comprehensive test coverage 
(1 ms)

  ΓùÅ ≡ƒº¬ Trek-Tribe 
Comprehensive Test Suite ΓÇ║ 
≡ƒôà Booking System ΓÇ║ GET 
/api/group-bookings/:id ΓÇ║ 
should reject unauthorized 
access to booking

    expected 403 
"Forbidden", got 401 
"Unauthorized"

    [0m [90m 411 |[39m    
       [33m.[39m[36mget[3
9m([32m`/api/group-bookings/
${bookingId}`[39m)
     [90m 412 |[39m        
   [33m.[39m[36mset[39m(
[32m'Authorization'[39m[33m
,[39m [32m`Bearer ${otherUs
erResponse.body.token}`[39m)
    
[31m[1m>[22m[39m[90m 
413 |[39m           [33m.[
39mexpect([35m403[39m)[33m
;[39m
     [90m     |[39m        
    [31m[1m^[22m[39m
     [90m 414 |[39m       
})[33m;[39m
     [90m 415 |[39m     
})[33m;[39m
     [90m 416 |[39m[0m

      at Object.<anonymous> (
src/__tests__/comprehensive.t
est.ts:413:12)
      ----
      at Test._assertStatus (
node_modules/supertest/lib/te
st.js:252:14)
      at node_modules/superte
st/lib/test.js:308:13
      at 
Test._assertFunction (node_mo
dules/supertest/lib/test.js:2
85:13)
      at Test.assert (node_mo
dules/supertest/lib/test.js:1
64:23)
      at Server.localAssert (
node_modules/supertest/lib/te
st.js:120:14)

  ΓùÅ ≡ƒº¬ Trek-Tribe 
Comprehensive Test Suite ΓÇ║ 
ΓÜí Performance & Limits ΓÇ║ 
should enforce trip posting 
limits for subscription

    expect(received).toBeGrea
terThan(expected)

    Expected: > 0
    Received:   0

    [0m [90m 855 |[39m    
   [90m// Try to create 
trips up to the limit[39m
     [90m 856 |[39m       
[90m// (This is a 
conceptual test - actual 
implementation would create 
multiple trips)[39m
    
[31m[1m>[22m[39m[90m 
857 |[39m       expect(trips
Allowed)[33m.[39mtoBeGreate
rThan([35m0[39m)[33m;[39m
     [90m     |[39m        
                    
[31m[1m^[22m[39m
     [90m 858 |[39m     
})[33m;[39m
     [90m 859 |[39m   
})[33m;[39m
     [90m 860 |[39m[0m

      at Object.<anonymous> (
src/__tests__/comprehensive.t
est.ts:857:28)

Test Suites: 1 failed, 1 
total
Tests:       2 failed, 56 
passed, 58 total
Snapshots:   0 total
Time:        14.24 s, 
estimated 16 s
Ran all test suites matching 
/src\\__tests__\\comprehensiv
e.test.ts/i.
Jest did not exit one second 
after the test run has 
completed.

'This usually means that 
there are asynchronous 
operations that weren't 
stopped in your tests. 
Consider running Jest with 
`--detectOpenHandles` to 
troubleshoot this issue.
