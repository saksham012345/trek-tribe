  console.log
    [33mΓÜá∩╕Å  [2026-02-08T11:26:47.631Z] WARN: SMS service running in development mode only - OTPs will be logged instead of sent.[0m

      at Logger.log (src/utils/logger.ts:151:13)

  console.log
    [36mΓä╣∩╕Å  [2026-02-08T11:26:48.257Z] INFO: Razorpay Route service initialized[0m

      at Logger.log (src/utils/logger.ts:151:13)

  console.log
    [36mΓä╣∩╕Å  [2026-02-08T11:26:49.219Z] INFO: Trek Tribe AI initialized with advanced capabilities[0m

      at Logger.log (src/utils/logger.ts:151:13)

  console.log
    Γ£à Razorpay initialized for subscriptions

      at Object.<anonymous> (src/routes/subscriptions.ts:20:13)

  console.warn
    ΓÜá∩╕Å OpenAI API key not found. Using local TF-IDF fallback.

    [0m [90m 43 |[39m           console[33m.[39mlog([32m'Γä╣∩╕Å AI Offline Mode enabled. Using local TF-IDF fallback.'[39m)[33m;[39m
     [90m 44 |[39m         } [36melse[39m {
    [31m[1m>[22m[39m[90m 45 |[39m           console[33m.[39mwarn([32m'ΓÜá∩╕Å OpenAI API key not found. Using local TF-IDF fallback.'[39m)[33m;[39m
     [90m    |[39m                   [31m[1m^[22m[39m
     [90m 46 |[39m         }
     [90m 47 |[39m         [36mthis[39m[33m.[39minitializeTFIDFFallback()[33m;[39m
     [90m 48 |[39m       }[0m

      at EmbeddingService.initialize (src/services/embeddingService.ts:45:19)
      at new EmbeddingService (src/services/embeddingService.ts:26:10)
      at Object.<anonymous> (src/services/embeddingService.ts:350:33)
      at Object.<anonymous> (src/services/generalKnowledge.ts:1:1)
      at Object.<anonymous> (src/routes/ai.ts:14:1)
      at Object.<anonymous> (src/__tests__/comprehensive.test.ts:9:1)

  console.log
    ≡ƒôè TF-IDF fallback embedding service ready

      at EmbeddingService.initializeTFIDFFallback (src/services/embeddingService.ts:68:13)

  console.warn
    ΓÜá∩╕Å OpenAI API key not found. Using local TF-IDF fallback.

    [0m [90m 43 |[39m           console[33m.[39mlog([32m'Γä╣∩╕Å AI Offline Mode enabled. Using local TF-IDF fallback.'[39m)[33m;[39m
     [90m 44 |[39m         } [36melse[39m {
    [31m[1m>[22m[39m[90m 45 |[39m           console[33m.[39mwarn([32m'ΓÜá∩╕Å OpenAI API key not found. Using local TF-IDF fallback.'[39m)[33m;[39m
     [90m    |[39m                   [31m[1m^[22m[39m
     [90m 46 |[39m         }
     [90m 47 |[39m         [36mthis[39m[33m.[39minitializeTFIDFFallback()[33m;[39m
     [90m 48 |[39m       }[0m

      at EmbeddingService.initialize (src/services/embeddingService.ts:45:19)
      at new EmbeddingService (src/services/embeddingService.ts:26:10)
      at Object.<anonymous> (src/services/generalKnowledge.ts:95:16)
      at Object.<anonymous> (src/routes/ai.ts:14:1)
      at Object.<anonymous> (src/__tests__/comprehensive.test.ts:9:1)

  console.log
    ≡ƒôè TF-IDF fallback embedding service ready

      at EmbeddingService.initializeTFIDFFallback (src/services/embeddingService.ts:68:13)

  console.log
    Γ£à Using pure JavaScript embeddings (no native dependencies)

      at new TransformerEmbeddingService (src/services/transformerEmbeddings.ts:31:13)

  console.log
    Γä╣∩╕Å  [2026-02-08T11:26:54.735Z] INFO: Trek Tribe AI initialized with advanced capabilities

      at Object.<anonymous> (src/routes/ai.ts:1220:9)

  console.log
    ≡ƒÜÇ Initializing Knowledge Base...

      at KnowledgeBaseService.initialize (src/services/knowledgeBase.ts:344:13)

  console.log
    ≡ƒñû JavaScript embeddings service ready

      at TransformerEmbeddingService.initialize (src/services/transformerEmbeddings.ts:111:13)

  console.log
    Γ£à Transformer embeddings service initialized

      at KnowledgeBaseService.initialize (src/services/knowledgeBase.ts:348:13)

  console.log
    ≡ƒöä Refreshing knowledge base...

      at KnowledgeBaseService.refreshKnowledgeBase (src/services/knowledgeBase.ts:365:15)

  console.log
    ≡ƒöä Fetching trips from local DB...

      at DataFetcherService.fetchAllTrips (src/services/dataFetcher.ts:66:15)

node.exe : (node:10264) 
[MONGOOSE] Warning: 
Duplicate schema index on 
{"status":1} found. This is 
often due to declaring an 
index using both "index: 
true" and "schema.index()". 
Please remove the duplicate 
index definition.
At line:1 char:1
+ & "C:\Program 
Files\nodejs/node.exe" 
"C:\Program 
Files\nodejs/node_mo ...
+ ~~~~~~~~~~~~~~~~~~~~~~~~~~~
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
~~~~~~~~~~~~~
    + CategoryInfo           
   : NotSpecified: ((node:1  
  0264) [M...dex definitio   
 n.:String) [], RemoteExc    
eption
    + FullyQualifiedErrorId  
   : NativeCommandError
 
(Use `node --trace-warnings 
...` to show where the 
warning was created)
(node:10264) [MONGOOSE] 
Warning: Duplicate schema 
index on {"slug":1} found. 
This is often due to 
declaring an index using 
both "index: true" and 
"schema.index()". Please 
remove the duplicate index 
definition.
  console.log
    ≡ƒôé Upload directory exists: C:\Users\hp\Desktop\trektribe\trek-tribe\services\api\uploads

      at FileHandler.initializeUploadDirectory (src/utils/fileHandler.ts:75:15)

  console.log
    Γ£à Fetched 0 trips from database

      at DataFetcherService.fetchAllTrips (src/services/dataFetcher.ts:118:15)

  console.log
    ≡ƒöä Fetching organizers from local DB...

      at DataFetcherService.fetchAllOrganizers (src/services/dataFetcher.ts:130:15)

  console.log
    Γ£à Fetched 0 organizers from database

      at DataFetcherService.fetchAllOrganizers (src/services/dataFetcher.ts:152:15)

  console.log
    ≡ƒöä Generating embeddings using transformer model...

      at KnowledgeBaseService.generateEmbeddings (src/services/knowledgeBase.ts:448:13)

  console.log
    Γ£à Generated 41 transformer-based embeddings

      at KnowledgeBaseService.generateEmbeddings (src/services/knowledgeBase.ts:460:15)

  console.log
    Γ£à Generated 41 embeddings

      at KnowledgeBaseService.generateEmbeddings (src/services/knowledgeBase.ts:466:13)

  console.log
    Γ£à Knowledge base refreshed: 41 documents (0 trips, 0 organizers, 41 base docs)

      at KnowledgeBaseService.refreshKnowledgeBase (src/services/knowledgeBase.ts:411:15)

  console.log
    Γ£à Knowledge Base initialized with 41 documents

      at KnowledgeBaseService.initialize (src/services/knowledgeBase.ts:360:13)

  console.log
    [33mΓÜá∩╕Å  [2026-02-08T11:27:03.908Z] WARN: Email service not ready, skipping email verification OTP[0m

      at Logger.log (src/utils/logger.ts:151:13)

  console.log
    [36mΓä╣∩╕Å  [2026-02-08T11:27:03.920Z] INFO: Registration email OTP sent[0m
    {
      "email": "traveler@test.com",
      "userId": "698873064b53608d15ddabe5",
      "role": "traveler"
    }

      at Logger.log (src/utils/logger.ts:151:13)

  console.log
    [36mΓä╣∩╕Å  [2026-02-08T11:27:04.981Z] INFO: Verification request created for new organizer[0m
    {
      "userId": "698873084b53608d15ddabf6",
      "email": "organizer@test.com"
    }

      at Logger.log (src/utils/logger.ts:151:13)

  console.log
    [33mΓÜá∩╕Å  [2026-02-08T11:27:05.871Z] WARN: Email service not ready, skipping email verification OTP[0m

      at Logger.log (src/utils/logger.ts:151:13)

  console.log
    [36mΓä╣∩╕Å  [2026-02-08T11:27:05.874Z] INFO: Registration email OTP sent[0m
    {
      "email": "organizer@test.com",
      "userId": "698873084b53608d15ddabf6",
      "role": "organizer"
    }

      at Logger.log (src/utils/logger.ts:151:13)

  console.log
    ≡ƒôÑ Received trip creation request: {
      title: 'Himalayan Adventure',
      destination: 'Manali, Himachal Pradesh',
      organizerId: '698873084b53608d15ddabf6',
      role: 'organizer',
      price: 15000,
      capacity: 20,
      startDate: '2026-03-10T11:27:07.677Z',
      endDate: '2026-03-17T11:27:07.677Z',
      categories: undefined,
      hasImages: false,
      hasSchedule: false,
      hasPaymentConfig: false
    }

      at src/routes/trips.ts:60:13

  console.error
    Γ¥î Validation failed in test mode: {
      formErrors: [],
      fieldErrors: { itinerary: [ 'Expected string, received array' ] }
    }

    [0m [90m 172 |[39m     } [36mcatch[39m (error[33m:[39m any) {
     [90m 173 |[39m       [36mif[39m (process[33m.[39menv[33m.[39m[33mNODE_ENV[39m [33m===[39m [32m'test'[39m) {
    [31m[1m>[22m[39m[90m 174 |[39m         console[33m.[39merror([32m'Γ¥î Validation failed in test mode:'[39m[33m,[39m error[33m.[39mflatten [33m?[39m error[33m.[39mflatten() [33m:[39m error[33m.[39mmessage)[33m;[39m
     [90m     |[39m                 [31m[1m^[22m[39m
     [90m 175 |[39m         [36mreturn[39m res[33m.[39mstatus([35m400[39m)[33m.[39mjson({
     [90m 176 |[39m           error[33m:[39m [32m'Validation failed'[39m[33m,[39m
     [90m 177 |[39m           details[33m:[39m error[33m.[39mflatten [33m?[39m error[33m.[39mflatten()[33m.[39mfieldErrors [33m:[39m error[33m.[39mmessage[0m

      at src/routes/trips.ts:174:17
      at src/routes/trips.ts:51:19
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at next (node_modules/express/lib/router/route.js:149:13)
      at verifyOrganizerApproved (src/middleware/verifyOrganizer.ts:17:14)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at next (node_modules/express/lib/router/route.js:149:13)
      at requireEmailVerified (src/middleware/auth.ts:168:5)

  console.log
    ≡ƒôÑ Received trip creation request: {
      title: 'Incomplete Trip',
      destination: undefined,
      organizerId: '698873084b53608d15ddabf6',
      role: 'organizer',
      price: undefined,
      capacity: undefined,
      startDate: undefined,
      endDate: undefined,
      categories: undefined,
      hasImages: false,
      hasSchedule: false,
      hasPaymentConfig: false
    }

      at src/routes/trips.ts:60:13

  console.log
    ≡ƒöì GET /trips - Query: { filter: { status: { '$in': [Array] } }, limit: 50 }

      at src/routes/trips.ts:540:13

  console.log
    Γ£à Found 0 trips

      at src/routes/trips.ts:548:13

  console.log
    ≡ƒöì GET /trips - Query: {
      filter: { status: { '$in': [Array] }, categories: 'trekking' },
      limit: 50
    }

      at src/routes/trips.ts:540:13

  console.log
    Γ£à Found 0 trips

      at src/routes/trips.ts:548:13

  console.log
    ≡ƒöì GET /trips - Query: {
      filter: {
        status: { '$in': [Array] },
        price: { '$gte': 10000, '$lte': 20000 }
      },
      limit: 50
    }

      at src/routes/trips.ts:540:13

  console.log
    Γ£à Found 0 trips

      at src/routes/trips.ts:548:13

  console.log
    ≡ƒôÑ Received booking request: {
      tripId: undefined,
      numberOfTravelers: 2,
      contactPhone: undefined,
      hasSelectedPackage: false,
      hasTravelerDetails: true,
      travelerDetailsCount: 2,
      fullBody: {
        numberOfGuests: 2,
        participants: [ [Object], [Object] ],
        paymentMethod: 'online',
        specialRequests: 'Vegetarian food please',
        numberOfTravelers: 2,
        travelerDetails: [ [Object], [Object] ]
      }
    }

      at src/routes/bookings.ts:46:13

  console.log
    ΓÜá∩╕Å Booking validation had issues, using fallback defaults

      at src/routes/bookings.ts:62:15

  console.log
    ≡ƒôÑ Received booking request: {
      tripId: '6988730c4b53608d15ddac0d',
      numberOfTravelers: 1,
      contactPhone: undefined,
      hasSelectedPackage: false,
      hasTravelerDetails: false,
      travelerDetailsCount: undefined,
      fullBody: {
        tripId: '6988730c4b53608d15ddac0d',
        numberOfGuests: 1,
        numberOfTravelers: 1
      }
    }

      at src/routes/bookings.ts:46:13

  console.log
    Γ£à Booking validation successful with data transformation

      at src/routes/bookings.ts:60:15

  console.log
    ≡ƒöì My bookings request (root): {
      userId: '698873064b53608d15ddabe5',
      auth: {
        id: '698873064b53608d15ddabe5',
        userId: '698873064b53608d15ddabe5',
        role: 'traveler'
      }
    }

      at src/routes/bookings.ts:313:13

  console.error
    Authentication error: jwt malformed

    [0m [90m 118 |[39m     [36mreturn[39m next()[33m;[39m
     [90m 119 |[39m   } [36mcatch[39m (err) {
    [31m[1m>[22m[39m[90m 120 |[39m     console[33m.[39merror([32m'Authentication error:'[39m[33m,[39m err [36minstanceof[39m [33mError[39m [33m?[39m err[33m.[39mmessage [33m:[39m err)[33m;[39m
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 121 |[39m     [36mreturn[39m res[33m.[39mstatus([35m401[39m)[33m.[39mjson({ error[33m:[39m [32m'Invalid token'[39m })[33m;[39m
     [90m 122 |[39m   }
     [90m 123 |[39m }[0m

      at authenticateToken (src/middleware/auth.ts:120:13)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at next (node_modules/express/lib/router/route.js:149:13)
      at Route.dispatch (node_modules/express/lib/router/route.js:119:3)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at node_modules/express/lib/router/index.js:284:15
      at param (node_modules/express/lib/router/index.js:365:14)
      at param (node_modules/express/lib/router/index.js:376:14)
      at router.process_params (node_modules/express/lib/router/index.js:421:3)
      at next (node_modules/express/lib/router/index.js:280:10)
      at router.handle (node_modules/express/lib/router/index.js:175:3)
      at router (node_modules/express/lib/router/index.js:47:12)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at router.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at jsonParser (node_modules/body-parser/lib/types/json.js:113:7)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at router.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at expressInit (node_modules/express/lib/middleware/init.js:40:5)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at router.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at query (node_modules/express/lib/middleware/query.js:45:5)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at router.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at router.handle (node_modules/express/lib/router/index.js:175:3)
      at app.handle (node_modules/express/lib/application.js:181:10)
      at Server.app (node_modules/express/lib/express.js:39:9)

  console.log
    ≡ƒô¥ Audit log: CREATE Subscription by user 698873084b53608d15ddabf6

      at AuditLogService.log (src/services/auditLogService.ts:63:15)

  console.log
    ≡ƒôì Follow-up detected: clarification Enhanced message: Tell me about adventure trips

      at src/routes/ai.ts:1412:15

  console.log
    ≡ƒôÑ Received booking request: {
      tripId: undefined,
      numberOfTravelers: 1,
      contactPhone: undefined,
      hasSelectedPackage: false,
      hasTravelerDetails: true,
      travelerDetailsCount: 1,
      fullBody: {
        numberOfGuests: 1,
        participants: [ [Object] ],
        paymentMethod: 'online',
        numberOfTravelers: 1,
        travelerDetails: [ [Object] ]
      }
    }

      at src/routes/bookings.ts:46:13

  console.log
    ΓÜá∩╕Å Booking validation had issues, using fallback defaults

      at src/routes/bookings.ts:62:15

  console.log
    [31m≡ƒÜ¿ [2026-02-08T11:27:08.696Z] ERROR: Error previewing booking receipt[0m
    {
      "error": "Cast to ObjectId failed for value \"undefined\" (type string) at path \"_id\" for model \"GroupBooking\""
    }

      at Logger.log (src/utils/logger.ts:151:13)

  console.log
    ≡ƒôÑ Received booking request: {
      tripId: undefined,
      numberOfTravelers: 1,
      contactPhone: undefined,
      hasSelectedPackage: false,
      hasTravelerDetails: true,
      travelerDetailsCount: 1,
      fullBody: {
        numberOfGuests: 1,
        participants: [ [Object] ],
        numberOfTravelers: 1,
        travelerDetails: [ [Object] ]
      }
    }

      at src/routes/bookings.ts:46:13

  console.log
    ΓÜá∩╕Å Booking validation had issues, using fallback defaults

      at src/routes/bookings.ts:62:15

  console.log
    [31m≡ƒÜ¿ [2026-02-08T11:27:08.741Z] ERROR: Error previewing booking receipt[0m
    {
      "error": "Cast to ObjectId failed for value \"undefined\" (type string) at path \"_id\" for model \"GroupBooking\""
    }

      at Logger.log (src/utils/logger.ts:151:13)

  console.log
    [36mΓä╣∩╕Å  [2026-02-08T11:27:09.127Z] INFO: Subscription receipt generated[0m
    {
      "subscriptionId": "6988730c4b53608d15ddac17",
      "userId": "698873084b53608d15ddabf6"
    }

      at Logger.log (src/utils/logger.ts:151:13)

  console.log
    ≡ƒöì GET /trips - Query: { filter: { status: 'active' }, limit: 50 }

      at src/routes/trips.ts:540:13

  console.log
    Γ£à Found 0 trips

      at src/routes/trips.ts:548:13

  console.log
    ≡ƒöì GET /trips - Query: { filter: { status: 'active', difficulty: 'moderate' }, limit: 50 }

      at src/routes/trips.ts:540:13

  console.log
    Γ£à Found 0 trips

      at src/routes/trips.ts:548:13

  console.log
    ≡ƒöì GET /trips - Query: { filter: { status: 'active' }, limit: 50 }

      at src/routes/trips.ts:540:13

  console.log
    Γ£à Found 0 trips

      at src/routes/trips.ts:548:13

  console.log
    ≡ƒöì GET /trips - Query: {
      filter: {
        status: 'active',
        categories: 'trekking',
        difficulty: 'moderate',
        price: { '$gte': 10000 }
      },
      limit: 50
    }

      at src/routes/trips.ts:540:13

  console.log
    Γ£à Found 0 trips

      at src/routes/trips.ts:548:13

  console.log
    ≡ƒôÑ Received trip creation request: {
      title: 'Invalid Trip',
      destination: 'Test',
      organizerId: '698873084b53608d15ddabf6',
      role: 'organizer',
      price: 5000,
      capacity: undefined,
      startDate: '2026-02-07T11:27:09.303Z',
      endDate: '2026-02-08T11:27:09.305Z',
      categories: undefined,
      hasImages: false,
      hasSchedule: false,
      hasPaymentConfig: false
    }

      at src/routes/trips.ts:60:13

  console.error
    Γ¥î Validation failed in test mode: {
      formErrors: [],
      fieldErrors: {
        description: [ 'Required' ],
        capacity: [ 'Required' ],
        categories: [ 'Required' ]
      }
    }

    [0m [90m 172 |[39m     } [36mcatch[39m (error[33m:[39m any) {
     [90m 173 |[39m       [36mif[39m (process[33m.[39menv[33m.[39m[33mNODE_ENV[39m [33m===[39m [32m'test'[39m) {
    [31m[1m>[22m[39m[90m 174 |[39m         console[33m.[39merror([32m'Γ¥î Validation failed in test mode:'[39m[33m,[39m error[33m.[39mflatten [33m?[39m error[33m.[39mflatten() [33m:[39m error[33m.[39mmessage)[33m;[39m
     [90m     |[39m                 [31m[1m^[22m[39m
     [90m 175 |[39m         [36mreturn[39m res[33m.[39mstatus([35m400[39m)[33m.[39mjson({
     [90m 176 |[39m           error[33m:[39m [32m'Validation failed'[39m[33m,[39m
     [90m 177 |[39m           details[33m:[39m error[33m.[39mflatten [33m?[39m error[33m.[39mflatten()[33m.[39mfieldErrors [33m:[39m error[33m.[39mmessage[0m

      at src/routes/trips.ts:174:17
      at src/routes/trips.ts:51:19
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at next (node_modules/express/lib/router/route.js:149:13)
      at verifyOrganizerApproved (src/middleware/verifyOrganizer.ts:17:14)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at next (node_modules/express/lib/router/route.js:149:13)
      at requireEmailVerified (src/middleware/auth.ts:168:5)

  console.log
    ≡ƒôÑ Received booking request: {
      tripId: undefined,
      numberOfTravelers: 10,
      contactPhone: undefined,
      hasSelectedPackage: false,
      hasTravelerDetails: true,
      travelerDetailsCount: 0,
      fullBody: {
        numberOfGuests: 10,
        participants: [],
        numberOfTravelers: 10,
        travelerDetails: []
      }
    }

      at src/routes/bookings.ts:46:13

  console.log
    ΓÜá∩╕Å Booking validation had issues, using fallback defaults

      at src/routes/bookings.ts:62:15

  console.log
    ≡ƒöì GET /trips - Query: { filter: { status: 'active' }, limit: 10 }

      at src/routes/trips.ts:540:13

  console.log
    Γ£à Found 0 trips

      at src/routes/trips.ts:548:13

  console.log
    [33mΓÜá∩╕Å  [2026-02-08T11:27:11.091Z] WARN: Email service not ready, skipping email verification OTP[0m

      at Logger.log (src/utils/logger.ts:151:13)

  console.log
    [36mΓä╣∩╕Å  [2026-02-08T11:27:11.093Z] INFO: Registration email OTP sent[0m
    {
      "email": "journey@test.com",
      "userId": "6988730e4b53608d15ddac4d",
      "role": "traveler"
    }

      at Logger.log (src/utils/logger.ts:151:13)

  console.log
    ≡ƒöì GET /trips - Query: { filter: { status: { '$in': [Array] } }, limit: 50 }

      at src/routes/trips.ts:540:13

  console.log
    Γ£à Found 0 trips

      at src/routes/trips.ts:548:13

  console.log
    [36mΓä╣∩╕Å  [2026-02-08T11:27:12.203Z] INFO: Verification request created for new organizer[0m
    {
      "userId": "698873104b53608d15ddac55",
      "email": "neworg@test.com"
    }

      at Logger.log (src/utils/logger.ts:151:13)

  console.log
    [33mΓÜá∩╕Å  [2026-02-08T11:27:13.059Z] WARN: Email service not ready, skipping email verification OTP[0m

      at Logger.log (src/utils/logger.ts:151:13)

  console.log
    [36mΓä╣∩╕Å  [2026-02-08T11:27:13.061Z] INFO: Registration email OTP sent[0m
    {
      "email": "neworg@test.com",
      "userId": "698873104b53608d15ddac55",
      "role": "organizer"
    }

      at Logger.log (src/utils/logger.ts:151:13)

  console.log
    ≡ƒô¥ Audit log: CREATE Subscription by user 698873104b53608d15ddac55

      at AuditLogService.log (src/services/auditLogService.ts:63:15)

  console.log
    ≡ƒôÑ Received trip creation request: {
      title: 'New Adventure',
      destination: 'Goa',
      organizerId: '698873104b53608d15ddac55',
      role: 'organizer',
      price: 8000,
      capacity: 15,
      startDate: '2026-03-10T11:27:13.128Z',
      endDate: '2026-03-15T11:27:13.129Z',
      categories: undefined,
      hasImages: false,
      hasSchedule: false,
      hasPaymentConfig: false
    }

      at src/routes/trips.ts:60:13

  console.log
    Γ£à Validation successful with data transformation

      at src/routes/trips.ts:171:15

  console.log
    Creating trip: {
      title: 'New Adventure',
      organizerId: '698873104b53608d15ddac55',
      destination: 'Goa'
    }

      at src/routes/trips.ts:266:13

  console.log
    Γ£à Trip created successfully: new ObjectId('698873114b53608d15ddac68')

      at src/routes/trips.ts:302:13

  console.log
    Γ£à Trip count incremented. Used: 1/4. Remaining: 3

      at src/routes/trips.ts:433:19

  console.log
    
        Γ£à Test Coverage Summary:
        - Authentication: Registration, Login, Token Validation
        - Trip Management: CRUD operations, Filters, Search
        - Booking System: Create, Read, Update, Cancel
        - Subscriptions: Plans, Trial, Eligibility
        - AI Features: Chat, Recommendations
        - Receipts: PDF Generation, Preview
        - Validation: Email, Phone, Dates, Capacity
        - Error Handling: 404, 400, 401, 403
        - Integration: Full user journeys

      at Object.<anonymous> (src/__tests__/comprehensive.test.ts:970:13)

FAIL src/__tests__/comprehens
ive.test.ts (49.329 s)
  ≡ƒº¬ Trek-Tribe 
Comprehensive Test Suite
    ≡ƒæñ Authentication & 
User Management
      POST /auth/register
        ΓêÜ should register 
a traveler successfully 
(6921 ms)
        ΓêÜ should register 
an organizer successfully 
(1894 ms)
        ΓêÜ should reject 
registration with weak 
password (24 ms)
        ΓêÜ should reject 
duplicate email registration 
(14 ms)
      POST /auth/login
        ΓêÜ should login 
successfully with correct 
credentials (855 ms)
        ΓêÜ should reject 
login with wrong password 
(809 ms)
        ΓêÜ should reject 
login for non-existent user 
(21 ms)
      GET /auth/me
        ΓêÜ should return 
user profile with valid 
token (35 ms)
        ΓêÜ should reject 
request without token (13 ms)
    ≡ƒù║∩╕Å Trip Management
      POST /trips
        ├ù should create a 
trip as organizer (69 ms)
        ΓêÜ should reject 
trip creation by traveler 
(16 ms)
        ΓêÜ should reject 
trip with missing required 
fields (22 ms)
      GET /trips
        ├ù should list all 
trips (47 ms)
        ΓêÜ should filter 
trips by category (25 ms)
        ΓêÜ should filter 
trips by price range (25 ms)
      GET /trips/:id
        ├ù should get trip 
details by ID (12 ms)
        ΓêÜ should return 
404 for non-existent trip 
(16 ms)
      PUT /trips/:id
        ├ù should update 
trip as organizer (16 ms)
        ├ù should activate 
trip for visibility (12 ms)
        ΓêÜ should reject 
update by non-owner (15 ms)
    ≡ƒôà Booking System
      POST 
/api/group-bookings
        ├ù should create a 
booking as traveler (47 ms)
        ΓêÜ should reject 
booking without 
authentication (11 ms)
        ΓêÜ should reject 
booking with invalid trip ID 
(20 ms)
      GET /api/group-bookings
        ├ù should list user 
bookings (26 ms)
      GET 
/api/group-bookings/:id
        ├ù should get 
booking details (13 ms)
        ├ù should reject 
unauthorized access to 
booking (46 ms)
      PUT 
/api/group-bookings/:id
        ├ù should update 
booking details (15 ms)
      DELETE 
/api/group-bookings/:id
        ├ù should cancel 
booking (12 ms)
    ≡ƒÆ│ Subscription & 
Payment System
      GET 
/api/subscriptions/plans
        ΓêÜ should list 
available subscription plans 
(14 ms)
      GET 
/api/subscriptions/my
        ΓêÜ should check 
subscription status for 
organizer (35 ms)
        ΓêÜ should return 
401 without authentication 
(11 ms)
      POST /api/subscriptions
/create-order
        ΓêÜ should create 
trial subscription for new 
organizer (60 ms)
        ΓêÜ should reject 
subscription creation for 
non-organizer (13 ms)
      GET /api/subscriptions/
check-eligibility
        ΓêÜ should check 
trip posting eligibility (23 
ms)
    ≡ƒñû AI Features
      POST /api/ai/chat
        ΓêÜ should process 
AI chat query (170 ms)
        ΓêÜ should handle 
trip-specific queries (102 
ms)
        ΓêÜ should reject 
empty messages (14 ms)
      GET 
/api/ai/recommendations
        ΓêÜ should get trip 
recommendations (19 ms)
    ≡ƒôä Receipt Generation
      GET /api/receipts/booki
ng/:bookingId/preview
        ├ù should preview 
booking receipt data (22 ms)
        ├ù should reject 
preview for unpaid booking 
(40 ms)
      GET /api/receipts/subsc
ription/:subscriptionId
        ΓêÜ should generate 
subscription receipt for 
paid subscription (387 ms)
        ├ù should reject 
receipt for trial 
subscription (21 ms)
    ≡ƒöì Search & Filter
      GET /trips - Advanced 
Filters
        ΓêÜ should search 
trips by title (21 ms)
        ΓêÜ should filter by 
difficulty level (22 ms)
        ΓêÜ should filter by 
date range (21 ms)
        ΓêÜ should combine 
multiple filters (26 ms)
    Γ£à Validation & Error 
Handling
      ΓêÜ should validate 
email format (14 ms)
      ΓêÜ should validate 
phone number format (12 ms)
      ΓêÜ should validate 
trip dates (39 ms)
      ΓêÜ should validate 
booking capacity (29 ms)
      ΓêÜ should handle 404 
for non-existent resources 
(20 ms)
      ΓêÜ should handle 
malformed MongoDB IDs (14 ms)
    ΓÜí Performance & Limits
      ΓêÜ should handle 
large result sets with 
pagination (30 ms)
      ΓêÜ should reject 
excessively large file 
uploads (1 ms)
      ΓêÜ should enforce 
trip posting limits for 
subscription (21 ms)
    ≡ƒöù End-to-End 
Integration
      ├ù should complete 
full user journey: register 
ΓåÆ browse ΓåÆ book ΓåÆ pay 
(1671 ms)
      ΓêÜ should complete 
organizer journey: register 
ΓåÆ subscribe ΓåÆ create 
trip (2097 ms)
  ≡ƒôè Test Summary
    ΓêÜ should have 
comprehensive test coverage 
(8 ms)

  ΓùÅ ≡ƒº¬ Trek-Tribe 
Comprehensive Test Suite ΓÇ║ 
≡ƒù║∩╕Å Trip Management ΓÇ║ 
POST /trips ΓÇ║ should 
create a trip as organizer

    expected 201 "Created", 
got 400 "Bad Request"

    [0m [90m 184 |[39m    
         ]
     [90m 185 |[39m        
   })
    
[31m[1m>[22m[39m[90m 
186 |[39m           [33m.[
39mexpect([35m201[39m)[33m
;[39m
     [90m     |[39m        
    [31m[1m^[22m[39m
     [90m 187 |[39m
     [90m 188 |[39m        
 expect(response[33m.[39mbo
dy)[33m.[39mtoHaveProperty(
[32m'_id'[39m)[33m;[39m
     [90m 189 |[39m        
 expect(response[33m.[39mbo
dy[33m.[39mtitle)[33m.[39
mtoBe([32m'Himalayan Adventu
re'[39m)[33m;[39m[0m

      at Object.<anonymous> (
src/__tests__/comprehensive.t
est.ts:186:12)
      ----
      at Test._assertStatus (
node_modules/supertest/lib/te
st.js:252:14)
      at node_modules/superte
st/lib/test.js:308:13
      at 
Test._assertFunction (node_mo
dules/supertest/lib/test.js:2
85:13)
      at Test.assert (node_mo
dules/supertest/lib/test.js:1
64:23)
      at Server.localAssert (
node_modules/supertest/lib/te
st.js:120:14)

  ΓùÅ ≡ƒº¬ Trek-Tribe 
Comprehensive Test Suite ΓÇ║ 
≡ƒù║∩╕Å Trip Management ΓÇ║ 
GET /trips ΓÇ║ should list 
all trips

    expect(received).toBeGrea
terThan(expected)

    Expected: > 0
    Received:   0

    [0m [90m 223 |[39m
     [90m 224 |[39m        
 expect([33mArray[39m[33m.
[39misArray(response[33m.[
39mbody))[33m.[39mtoBe([36
mtrue[39m)[33m;[39m
    
[31m[1m>[22m[39m[90m 
225 |[39m         expect(res
ponse[33m.[39mbody[33m.[3
9mlength)[33m.[39mtoBeGreat
erThan([35m0[39m)[33m;[39
m
     [90m     |[39m        
                             
 [31m[1m^[22m[39m
     [90m 226 |[39m       
})[33m;[39m
     [90m 227 |[39m
     [90m 228 |[39m       
it([32m'should filter trips 
by category'[39m[33m,[39m 
[36masync[39m () 
[33m=>[39m {[0m

      at Object.<anonymous> (
src/__tests__/comprehensive.t
est.ts:225:38)

  ΓùÅ ≡ƒº¬ Trek-Tribe 
Comprehensive Test Suite ΓÇ║ 
≡ƒù║∩╕Å Trip Management ΓÇ║ 
GET /trips/:id ΓÇ║ should 
get trip details by ID

    expected 200 "OK", got 
400 "Bad Request"

    [0m [90m 254 |[39m    
     [36mconst[39m 
response [33m=[39m 
[36mawait[39m request(app)
     [90m 255 |[39m        
   [33m.[39m[36mget[39m(
[32m`/trips/${tripId}`[39m)
    
[31m[1m>[22m[39m[90m 
256 |[39m           [33m.[
39mexpect([35m200[39m)[33m
;[39m
     [90m     |[39m        
    [31m[1m^[22m[39m
     [90m 257 |[39m
     [90m 258 |[39m        
 expect(response[33m.[39mbo
dy[33m.[39m_id)[33m.[39mt
oBe(tripId)[33m;[39m
     [90m 259 |[39m        
 expect(response[33m.[39mbo
dy[33m.[39mtitle)[33m.[39
mtoBe([32m'Himalayan Adventu
re'[39m)[33m;[39m[0m

      at Object.<anonymous> (
src/__tests__/comprehensive.t
est.ts:256:12)
      ----
      at Test._assertStatus (
node_modules/supertest/lib/te
st.js:252:14)
      at node_modules/superte
st/lib/test.js:308:13
      at 
Test._assertFunction (node_mo
dules/supertest/lib/test.js:2
85:13)
      at Test.assert (node_mo
dules/supertest/lib/test.js:1
64:23)
      at Server.localAssert (
node_modules/supertest/lib/te
st.js:120:14)

  ΓùÅ ≡ƒº¬ Trek-Tribe 
Comprehensive Test Suite ΓÇ║ 
≡ƒù║∩╕Å Trip Management ΓÇ║ 
PUT /trips/:id ΓÇ║ should 
update trip as organizer

    expected 200 "OK", got 
400 "Bad Request"

    [0m [90m 277 |[39m    
         capacity[33m:[39m 
[35m25[39m
     [90m 278 |[39m        
   })
    
[31m[1m>[22m[39m[90m 
279 |[39m           [33m.[
39mexpect([35m200[39m)[33m
;[39m
     [90m     |[39m        
    [31m[1m^[22m[39m
     [90m 280 |[39m
     [90m 281 |[39m        
 expect(response[33m.[39mbo
dy[33m.[39mprice)[33m.[39
mtoBe([35m16000[39m)[33m;
[39m
     [90m 282 |[39m        
 expect(response[33m.[39mbo
dy[33m.[39mprice)[33m.[39
mtoBe([35m16000[39m)[33m;
[39m[0m

      at Object.<anonymous> (
src/__tests__/comprehensive.t
est.ts:279:12)
      ----
      at Test._assertStatus (
node_modules/supertest/lib/te
st.js:252:14)
      at node_modules/superte
st/lib/test.js:308:13
      at 
Test._assertFunction (node_mo
dules/supertest/lib/test.js:2
85:13)
      at Test.assert (node_mo
dules/supertest/lib/test.js:1
64:23)
      at Server.localAssert (
node_modules/supertest/lib/te
st.js:120:14)

  ΓùÅ ≡ƒº¬ Trek-Tribe 
Comprehensive Test Suite ΓÇ║ 
≡ƒù║∩╕Å Trip Management ΓÇ║ 
PUT /trips/:id ΓÇ║ should 
activate trip for visibility

    expected 200 "OK", got 
400 "Bad Request"

    [0m [90m 291 |[39m    
         status[33m:[39m 
[32m'active'[39m
     [90m 292 |[39m        
   })
    
[31m[1m>[22m[39m[90m 
293 |[39m           [33m.[
39mexpect([35m200[39m)[33m
;[39m
     [90m     |[39m        
    [31m[1m^[22m[39m
     [90m 294 |[39m
     [90m 295 |[39m        
 expect(response[33m.[39mbo
dy[33m.[39mstatus)[33m.[3
9mtoBe([32m'active'[39m)[3
3m;[39m
     [90m 296 |[39m        
 console[33m.[39mlog([32m'
Γ£à Trip activated for 
testing:'[39m[33m,[39m 
tripId)[33m;[39m[0m

      at Object.<anonymous> (
src/__tests__/comprehensive.t
est.ts:293:12)
      ----
      at Test._assertStatus (
node_modules/supertest/lib/te
st.js:252:14)
      at node_modules/superte
st/lib/test.js:308:13
      at 
Test._assertFunction (node_mo
dules/supertest/lib/test.js:2
85:13)
      at Test.assert (node_mo
dules/supertest/lib/test.js:1
64:23)
      at Server.localAssert (
node_modules/supertest/lib/te
st.js:120:14)

  ΓùÅ ≡ƒº¬ Trek-Tribe 
Comprehensive Test Suite ΓÇ║ 
≡ƒôà Booking System ΓÇ║ POST 
/api/group-bookings ΓÇ║ 
should create a booking as 
traveler

    expected 201 "Created", 
got 400 "Bad Request"

    [0m [90m 342 |[39m    
         
specialRequests[33m:[39m 
[32m'Vegetarian food 
please'[39m
     [90m 343 |[39m        
   })
    
[31m[1m>[22m[39m[90m 
344 |[39m           [33m.[
39mexpect([35m201[39m)[33m
;[39m
     [90m     |[39m        
    [31m[1m^[22m[39m
     [90m 345 |[39m
     [90m 346 |[39m        
 expect(response[33m.[39mbo
dy)[33m.[39mtoHaveProperty(
[32m'_id'[39m)[33m;[39m
     [90m 347 |[39m        
 expect(response[33m.[39mbo
dy[33m.[39mnumberOfGuests)
[33m.[39mtoBe([35m2[39m)[
33m;[39m[0m

      at Object.<anonymous> (
src/__tests__/comprehensive.t
est.ts:344:12)
      ----
      at Test._assertStatus (
node_modules/supertest/lib/te
st.js:252:14)
      at node_modules/superte
st/lib/test.js:308:13
      at 
Test._assertFunction (node_mo
dules/supertest/lib/test.js:2
85:13)
      at Test.assert (node_mo
dules/supertest/lib/test.js:1
64:23)
      at Server.localAssert (
node_modules/supertest/lib/te
st.js:120:14)

  ΓùÅ ≡ƒº¬ Trek-Tribe 
Comprehensive Test Suite ΓÇ║ 
≡ƒôà Booking System ΓÇ║ GET 
/api/group-bookings ΓÇ║ 
should list user bookings

    expect(received).toBeGrea
terThan(expected)

    Expected: > 0
    Received:   0

    [0m [90m 382 |[39m
     [90m 383 |[39m        
 expect([33mArray[39m[33m.
[39misArray(response[33m.[
39mbody))[33m.[39mtoBe([36
mtrue[39m)[33m;[39m
    
[31m[1m>[22m[39m[90m 
384 |[39m         expect(res
ponse[33m.[39mbody[33m.[3
9mlength)[33m.[39mtoBeGreat
erThan([35m0[39m)[33m;[39
m
     [90m     |[39m        
                             
 [31m[1m^[22m[39m
     [90m 385 |[39m       
})[33m;[39m
     [90m 386 |[39m     
})[33m;[39m
     [90m 387 |[39m[0m

      at Object.<anonymous> (
src/__tests__/comprehensive.t
est.ts:384:38)

  ΓùÅ ≡ƒº¬ Trek-Tribe 
Comprehensive Test Suite ΓÇ║ 
≡ƒôà Booking System ΓÇ║ GET 
/api/group-bookings/:id ΓÇ║ 
should get booking details

    expected 200 "OK", got 
400 "Bad Request"

    [0m [90m 391 |[39m    
       [33m.[39m[36mget[3
9m([32m`/api/group-bookings/
${bookingId}`[39m)
     [90m 392 |[39m        
   [33m.[39m[36mset[39m(
[32m'Authorization'[39m[33m
,[39m [32m`Bearer 
${travelerToken}`[39m)
    
[31m[1m>[22m[39m[90m 
393 |[39m           [33m.[
39mexpect([35m200[39m)[33m
;[39m
     [90m     |[39m        
    [31m[1m^[22m[39m
     [90m 394 |[39m
     [90m 395 |[39m        
 expect(response[33m.[39mbo
dy[33m.[39m_id)[33m.[39mt
oBe(bookingId)[33m;[39m
     [90m 396 |[39m        
 expect(response[33m.[39mbo
dy[33m.[39mnumberOfGuests)
[33m.[39mtoBe([35m2[39m)[
33m;[39m[0m

      at Object.<anonymous> (
src/__tests__/comprehensive.t
est.ts:393:12)
      ----
      at Test._assertStatus (
node_modules/supertest/lib/te
st.js:252:14)
      at node_modules/superte
st/lib/test.js:308:13
      at 
Test._assertFunction (node_mo
dules/supertest/lib/test.js:2
85:13)
      at Test.assert (node_mo
dules/supertest/lib/test.js:1
64:23)
      at Server.localAssert (
node_modules/supertest/lib/te
st.js:120:14)

  ΓùÅ ≡ƒº¬ Trek-Tribe 
Comprehensive Test Suite ΓÇ║ 
≡ƒôà Booking System ΓÇ║ GET 
/api/group-bookings/:id ΓÇ║ 
should reject unauthorized 
access to booking

    expected 403 
"Forbidden", got 401 
"Unauthorized"

    [0m [90m 411 |[39m    
       [33m.[39m[36mget[3
9m([32m`/api/group-bookings/
${bookingId}`[39m)
     [90m 412 |[39m        
   [33m.[39m[36mset[39m(
[32m'Authorization'[39m[33m
,[39m [32m`Bearer ${otherUs
erResponse.body.token}`[39m)
    
[31m[1m>[22m[39m[90m 
413 |[39m           [33m.[
39mexpect([35m403[39m)[33m
;[39m
     [90m     |[39m        
    [31m[1m^[22m[39m
     [90m 414 |[39m       
})[33m;[39m
     [90m 415 |[39m     
})[33m;[39m
     [90m 416 |[39m[0m

      at Object.<anonymous> (
src/__tests__/comprehensive.t
est.ts:413:12)
      ----
      at Test._assertStatus (
node_modules/supertest/lib/te
st.js:252:14)
      at node_modules/superte
st/lib/test.js:308:13
      at 
Test._assertFunction (node_mo
dules/supertest/lib/test.js:2
85:13)
      at Test.assert (node_mo
dules/supertest/lib/test.js:1
64:23)
      at Server.localAssert (
node_modules/supertest/lib/te
st.js:120:14)

  ΓùÅ ≡ƒº¬ Trek-Tribe 
Comprehensive Test Suite ΓÇ║ 
≡ƒôà Booking System ΓÇ║ PUT 
/api/group-bookings/:id ΓÇ║ 
should update booking details

    expected 200 "OK", got 
400 "Bad Request"

    [0m [90m 423 |[39m    
         
specialRequests[33m:[39m 
[32m'Vegetarian food and 
early check-in'[39m
     [90m 424 |[39m        
   })
    
[31m[1m>[22m[39m[90m 
425 |[39m           [33m.[
39mexpect([35m200[39m)[33m
;[39m
     [90m     |[39m        
    [31m[1m^[22m[39m
     [90m 426 |[39m
     [90m 427 |[39m        
 expect(response[33m.[39mbo
dy[33m.[39mspecialRequests)
[33m.[39mtoContain([32m'ea
rly 
check-in'[39m)[33m;[39m
     [90m 428 |[39m       
})[33m;[39m[0m

      at Object.<anonymous> (
src/__tests__/comprehensive.t
est.ts:425:12)
      ----
      at Test._assertStatus (
node_modules/supertest/lib/te
st.js:252:14)
      at node_modules/superte
st/lib/test.js:308:13
      at 
Test._assertFunction (node_mo
dules/supertest/lib/test.js:2
85:13)
      at Test.assert (node_mo
dules/supertest/lib/test.js:1
64:23)
      at Server.localAssert (
node_modules/supertest/lib/te
st.js:120:14)

  ΓùÅ ≡ƒº¬ Trek-Tribe 
Comprehensive Test Suite ΓÇ║ 
≡ƒôà Booking System ΓÇ║ 
DELETE 
/api/group-bookings/:id ΓÇ║ 
should cancel booking

    expected 200 "OK", got 
400 "Bad Request"

    [0m [90m 434 |[39m    
       [33m.[39m[36mdelete
[39m([32m`/api/group-bookin
gs/${bookingId}`[39m)
     [90m 435 |[39m        
   [33m.[39m[36mset[39m(
[32m'Authorization'[39m[33m
,[39m [32m`Bearer 
${travelerToken}`[39m)
    
[31m[1m>[22m[39m[90m 
436 |[39m           [33m.[
39mexpect([35m200[39m)[33m
;[39m
     [90m     |[39m        
    [31m[1m^[22m[39m
     [90m 437 |[39m
     [90m 438 |[39m        
 expect(response[33m.[39mbo
dy[33m.[39mbookingStatus)[
33m.[39mtoBe([32m'cancelled
'[39m)[33m;[39m
     [90m 439 |[39m       
})[33m;[39m[0m

      at Object.<anonymous> (
src/__tests__/comprehensive.t
est.ts:436:12)
      ----
      at Test._assertStatus (
node_modules/supertest/lib/te
st.js:252:14)
      at node_modules/superte
st/lib/test.js:308:13
      at 
Test._assertFunction (node_mo
dules/supertest/lib/test.js:2
85:13)
      at Test.assert (node_mo
dules/supertest/lib/test.js:1
64:23)
      at Server.localAssert (
node_modules/supertest/lib/te
st.js:120:14)

  ΓùÅ ≡ƒº¬ Trek-Tribe 
Comprehensive Test Suite ΓÇ║ 
≡ƒôä Receipt Generation ΓÇ║ 
GET /api/receipts/booking/:bo
okingId/preview ΓÇ║ should 
preview booking receipt data

    expected 200 "OK", got 
500 "Internal Server Error"

    [0m [90m 626 |[39m    
       [33m.[39m[36mget[3
9m([32m`/api/receipts/bookin
g/${completedBookingId}/previ
ew`[39m)
     [90m 627 |[39m        
   [33m.[39m[36mset[39m(
[32m'Authorization'[39m[33m
,[39m [32m`Bearer 
${travelerToken}`[39m)
    
[31m[1m>[22m[39m[90m 
628 |[39m           [33m.[
39mexpect([35m200[39m)[33m
;[39m
     [90m     |[39m        
    [31m[1m^[22m[39m
     [90m 629 |[39m
     [90m 630 |[39m        
 expect(response[33m.[39mbo
dy)[33m.[39mtoHaveProperty(
[32m'receiptId'[39m)[33m;
[39m
     [90m 631 |[39m        
 expect(response[33m.[39mbo
dy)[33m.[39mtoHaveProperty(
[32m'userName'[39m)[33m;[
39m[0m

      at Object.<anonymous> (
src/__tests__/comprehensive.t
est.ts:628:12)
      ----
      at Test._assertStatus (
node_modules/supertest/lib/te
st.js:252:14)
      at node_modules/superte
st/lib/test.js:308:13
      at 
Test._assertFunction (node_mo
dules/supertest/lib/test.js:2
85:13)
      at Test.assert (node_mo
dules/supertest/lib/test.js:1
64:23)
      at Server.localAssert (
node_modules/supertest/lib/te
st.js:120:14)

  ΓùÅ ≡ƒº¬ Trek-Tribe 
Comprehensive Test Suite ΓÇ║ 
≡ƒôä Receipt Generation ΓÇ║ 
GET /api/receipts/booking/:bo
okingId/preview ΓÇ║ should 
reject preview for unpaid 
booking

    expected 400 "Bad 
Request", got 500 "Internal 
Server Error"

    [0m [90m 654 |[39m    
       [33m.[39m[36mget[3
9m([32m`/api/receipts/bookin
g/${unpaidBooking.body._id}/p
review`[39m)
     [90m 655 |[39m        
   [33m.[39m[36mset[39m(
[32m'Authorization'[39m[33m
,[39m [32m`Bearer 
${travelerToken}`[39m)
    
[31m[1m>[22m[39m[90m 
656 |[39m           [33m.[
39mexpect([35m400[39m)[33m
;[39m
     [90m     |[39m        
    [31m[1m^[22m[39m
     [90m 657 |[39m       
})[33m;[39m
     [90m 658 |[39m     
})[33m;[39m
     [90m 659 |[39m[0m

      at Object.<anonymous> (
src/__tests__/comprehensive.t
est.ts:656:12)
      ----
      at Test._assertStatus (
node_modules/supertest/lib/te
st.js:252:14)
      at node_modules/superte
st/lib/test.js:308:13
      at 
Test._assertFunction (node_mo
dules/supertest/lib/test.js:2
85:13)
      at Test.assert (node_mo
dules/supertest/lib/test.js:1
64:23)
      at Server.localAssert (
node_modules/supertest/lib/te
st.js:120:14)

  ΓùÅ ≡ƒº¬ Trek-Tribe 
Comprehensive Test Suite ΓÇ║ 
≡ƒôä Receipt Generation ΓÇ║ 
GET /api/receipts/subscriptio
n/:subscriptionId ΓÇ║ should 
reject receipt for trial 
subscription

    MongoServerError: E11000 
duplicate key error 
collection: 
test.organizersubscriptions 
index: organizerId_1 dup 
key: { organizerId: ObjectId(
'698873084b53608d15ddabf6') }

      at 
InsertOneOperation.execute (n
ode_modules/mongodb/src/opera
tions/insert.ts:88:13)
      at tryOperation (node_m
odules/mongodb/src/operations
/execute_operation.ts:283:14)
      at executeOperation (no
de_modules/mongodb/src/operat
ions/execute_operation.ts:115
:12)
      at 
Collection.insertOne (node_mo
dules/mongodb/src/collection.
ts:286:12)

  ΓùÅ ≡ƒº¬ Trek-Tribe 
Comprehensive Test Suite ΓÇ║ 
≡ƒöù End-to-End Integration 
ΓÇ║ should complete full 
user journey: register ΓåÆ 
browse ΓåÆ book ΓåÆ pay

    expect(received).toBeGrea
terThan(expected)

    Expected: > 0
    Received:   0

    [0m [90m 882 |[39m    
     [33m.[39mexpect([35m2
00[39m)[33m;[39m
     [90m 883 |[39m
    
[31m[1m>[22m[39m[90m 
884 |[39m       expect(trips
Response[33m.[39mbody[33m.
[39mlength)[33m.[39mtoBeGr
eaterThan([35m0[39m)[33m;
[39m
     [90m     |[39m        
                             
    [31m[1m^[22m[39m
     [90m 885 |[39m
     [90m 886 |[39m       
[90m// 3. Create 
booking[39m
     [90m 887 |[39m       
[36mconst[39m 
bookingResponse [33m=[39m 
[36mawait[39m 
request(app)[0m

      at Object.<anonymous> (
src/__tests__/comprehensive.t
est.ts:884:41)

Test Suites: 1 failed, 1 
total
Tests:       15 failed, 43 
passed, 58 total
Snapshots:   0 total
Time:        49.827 s, 
estimated 51 s
Ran all test suites matching 
/src\\__tests__\\comprehensiv
e.test.ts/i.
Jest did not exit one second 
after the test run has 
completed.

'This usually means that 
there are asynchronous 
operations that weren't 
stopped in your tests. 
Consider running Jest with 
`--detectOpenHandles` to 
troubleshoot this issue.
