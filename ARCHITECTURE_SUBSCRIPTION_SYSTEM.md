# ğŸ“ Subscription System Architecture

## Complete System Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        TREK TRIBE SUBSCRIPTION SYSTEM                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                              USER JOURNEY
                              
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  New Organizer   â”‚
â”‚   Visits App     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Navigate to /auto-pay-setup     â”‚
â”‚  (1st time or upgrade needed)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        SUBSCRIPTION PLANS PAGE - Plan Selection Interface         â”‚
â”‚                                                                   â”‚
â”‚  [STARTER]  [BASIC]  [PROFESSIONAL]  [PREMIUM]  [ENTERPRISE]   â”‚
â”‚   â‚¹999     â‚¹1499    â‚¹2199â­POPULAR   â‚¹2999    â‚¹4999             â”‚
â”‚  5 trips   10 trips   15 trips      20 trips   Unlimited         â”‚
â”‚                                                                   â”‚
â”‚  User can click any plan to see details and compare features    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       PLAN DETAILS PANEL (Expands when plan selected)            â”‚
â”‚                                                                   â”‚
â”‚  PROFESSIONAL Plan (â‚¹2199/month) Selected                        â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                       â”‚
â”‚                                                                   â”‚
â”‚  Features:                          Plan Summary:                â”‚
â”‚  âœ… List 15 active trips           Monthly: â‚¹2199               â”‚
â”‚  âœ… Auto-pay setup                 Trips: 15                     â”‚
â”‚  âœ… Full CRM Access          â†â”€â”€â”€â”€ CRM: âœ… Included             â”‚
â”‚  âœ… Lead Capture & Mgmt      â†â”€â”€â”€â”€ Leads: âœ… Included           â”‚
â”‚  âœ… Phone Numbers in Leads   â†â”€â”€â”€â”€ Phone#: âœ… Visible           â”‚
â”‚  âœ… Lead Verification System                                     â”‚
â”‚  âœ… Contact Management                                           â”‚
â”‚                                                                   â”‚
â”‚  Payment Method: Razorpay                                        â”‚
â”‚  [âœ“] I agree to Terms & Conditions                               â”‚
â”‚  [Complete Payment - â‚¹2199]                                      â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Click Payment Button            â”‚
â”‚   (With plan selected)            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Frontend Creates Order                â”‚
    â”‚  POST /api/subscriptions/create-order  â”‚
    â”‚  {                                     â”‚
    â”‚    planType: "PROFESSIONAL",           â”‚
    â”‚    skipTrial: false                    â”‚
    â”‚  }                                     â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Backend Creates Razorpay Order        â”‚
    â”‚  â€¢ Amount: 219900 paise (â‚¹2199)        â”‚
    â”‚  â€¢ Plan: PROFESSIONAL                  â”‚
    â”‚  â€¢ User ID: Attached to order          â”‚
    â”‚  â€¢ Returns: Order ID + Key              â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Razorpay Modal Opens                  â”‚
    â”‚  (Payment gateway)                     â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                           â”‚
    â–¼                           â–¼
[User Pays]             [User Cancels]
    â”‚                           â”‚
    â–¼                           â–¼
[Success]                  [Modal Closed]
    â”‚                           â”‚
    â–¼                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Frontend Verifies Payment                                       â”‚
â”‚  POST /api/subscriptions/verify-payment                          â”‚
â”‚  {                                                               â”‚
â”‚    razorpay_order_id: "order_XXX",                              â”‚
â”‚    razorpay_payment_id: "pay_XXX",                              â”‚
â”‚    razorpay_signature: "sig_XXX",  â†â”€â”€â”€ Signature Verification â”‚
â”‚    planType: "PROFESSIONAL"                                      â”‚
â”‚  }                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Backend Verifies Signature            â”‚
    â”‚  (HMAC-SHA256 validation)              â”‚
    â”‚                                        â”‚
    â”‚  If Valid: Continue âœ…                 â”‚
    â”‚  If Invalid: Reject âŒ                 â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Create Subscription in DB             â”‚
    â”‚                                        â”‚
    â”‚  db.organizersubscriptions.insert({   â”‚
    â”‚    userId: user_id,                    â”‚
    â”‚    planType: "PROFESSIONAL",           â”‚
    â”‚    price: 2199,                        â”‚
    â”‚    crmAccess: true,        â†â”€â”€â”€â”€â”€â”€â”   â”‚
    â”‚    leadCapture: true,      â†â”€â”€â”€â”€â”€â”€â”œâ”€ Features Enabled!
    â”‚    phoneNumbers: true,     â†â”€â”€â”€â”€â”€â”€â”˜   â”‚
    â”‚    status: "active",                   â”‚
    â”‚    maxTrips: 15,                       â”‚
    â”‚    nextBillingDate: ...                â”‚
    â”‚  })                                    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Create Audit Log                      â”‚
    â”‚  "Subscription created: PROFESSIONAL"  â”‚
    â”‚  "CRM access granted"                  â”‚
    â”‚  "Lead capture enabled"                â”‚
    â”‚  "Phone visibility enabled"            â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Return Success Response               â”‚
    â”‚  {                                     â”‚
    â”‚    success: true,                      â”‚
    â”‚    subscription: {...}                 â”‚
    â”‚  }                                     â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Frontend Receives Success             â”‚
    â”‚  â€¢ Show success toast                  â”‚
    â”‚  â€¢ Redirect to dashboard               â”‚
    â”‚  â€¢ User can now access CRM             â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Webhook Event Processing              â”‚
    â”‚  (Razorpay â†’ Backend webhook)          â”‚
    â”‚                                        â”‚
    â”‚  Event: payment.authorized             â”‚
    â”‚  Handler: Activate subscription        â”‚
    â”‚  Log: CRM features activated           â”‚
    â”‚                                        â”‚
    â”‚  Event: subscription.activated         â”‚
    â”‚  Handler: Send welcome email           â”‚
    â”‚  Include: CRM access guide             â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
         [SUCCESS]
         
    User now has:
    âœ… PROFESSIONAL subscription active
    âœ… CRM access granted
    âœ… Can create and manage leads
    âœ… Can view phone numbers
    âœ… Can verify leads
    âœ… 15 active trip slots
    âœ… Auto-billing set up for next month
```

---

## Feature Access Control Matrix

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    PLAN FEATURE MATRIX                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Feature      â”‚ STARTER â”‚ BASIC  â”‚PROFESSIONALâ”‚PREMIUMâ”‚ENTERPRISEâ”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Price        â”‚  â‚¹999   â”‚ â‚¹1499  â”‚  â‚¹2199 â­ â”‚ â‚¹2999 â”‚ â‚¹4999    â”‚
â”‚              â”‚         â”‚        â”‚   (CRM)   â”‚       â”‚          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Trip Slots   â”‚    5    â”‚   10   â”‚    15      â”‚   20   â”‚Unlimited â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ CRM Access   â”‚    âŒ   â”‚   âŒ   â”‚    âœ…      â”‚   âœ…   â”‚   âœ…     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Lead Capture â”‚    âŒ   â”‚   âŒ   â”‚    âœ…      â”‚   âœ…   â”‚   âœ…     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Phone #s     â”‚    âŒ   â”‚   âŒ   â”‚    âœ…      â”‚   âœ…   â”‚   âœ…     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Lead Verify  â”‚    âŒ   â”‚   âŒ   â”‚    âœ…      â”‚   âœ…   â”‚   âœ…     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Analytics    â”‚    âŒ   â”‚   âœ…   â”‚    âœ…      â”‚   âœ…   â”‚   âœ…     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Support      â”‚  Basic  â”‚ Standardâ”‚ Priority  â”‚Premium â”‚ Dedicatedâ”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Auto-pay     â”‚    âœ…   â”‚   âœ…   â”‚    âœ…      â”‚   âœ…   â”‚   âœ…     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Billing      â”‚ Monthly â”‚Monthly â”‚ Monthly    â”‚Monthly â”‚ Monthly  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

CRM FEATURES HIGHLIGHT (PROFESSIONAL & ABOVE):
âœ¨ Full CRM Access       - Customer management system
âœ¨ Lead Capture          - Capture leads from trip inquiries
âœ¨ Phone Numbers         - View and manage phone contacts
âœ¨ Lead Verification     - Verify lead authenticity
âœ¨ Contact Management    - Organize and categorize contacts
âœ¨ Advanced Analytics    - Track leads and conversions
```

---

## Database Schema

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           OrganizerSubscription Collection               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚
â”‚  {                                                       â”‚
â”‚    _id: ObjectId,              â† Unique subscription ID  â”‚
â”‚    userId: ObjectId,           â† Links to User          â”‚
â”‚    organizerId: ObjectId,      â† Links to Organizer    â”‚
â”‚                                                          â”‚
â”‚    // Plan Information                                  â”‚
â”‚    planType: "PROFESSIONAL",   â† Selected plan          â”‚
â”‚    price: 2199,                â† Monthly cost in â‚¹     â”‚
â”‚    currency: "INR",                                    â”‚
â”‚                                                          â”‚
â”‚    // Feature Flags for PROFESSIONAL PLAN âœ¨            â”‚
â”‚    crmAccess: true,            â† Can use CRM module    â”‚
â”‚    leadCapture: true,          â† Can capture leads     â”‚
â”‚    phoneNumbers: true,         â† Can see phone #s      â”‚
â”‚                                                          â”‚
â”‚    // Trip Limits                                       â”‚
â”‚    maxTrips: 15,               â† Can list 15 trips     â”‚
â”‚    currentTrips: 3,            â† Currently listed      â”‚
â”‚                                                          â”‚
â”‚    // Billing Information                              â”‚
â”‚    razorpaySubscriptionId: "sub_XXX",                  â”‚
â”‚    razorpayCustomerId: "cust_XXX",                     â”‚
â”‚    nextBillingDate: ISODate("2024-02-15"),            â”‚
â”‚    status: "active",           â† Can be: paused, cancelled
â”‚                                                          â”‚
â”‚    // Payment History                                   â”‚
â”‚    paymentHistory: [                                    â”‚
â”‚      {                                                   â”‚
â”‚        paymentId: "pay_XXX",                           â”‚
â”‚        razorpayPaymentId: "pay_XXX",                   â”‚
â”‚        amount: 2199,                                    â”‚
â”‚        date: ISODate("2024-01-15"),                    â”‚
â”‚        status: "success"        â† or "failed"          â”‚
â”‚      }                                                   â”‚
â”‚    ],                                                    â”‚
â”‚                                                          â”‚
â”‚    // Renewal Tracking                                  â”‚
â”‚    renewalDates: [                                      â”‚
â”‚      ISODate("2024-02-15"),                            â”‚
â”‚      ISODate("2024-03-15")                             â”‚
â”‚    ],                                                    â”‚
â”‚                                                          â”‚
â”‚    // Timestamps                                        â”‚
â”‚    createdAt: ISODate("2024-01-15T10:30:00Z"),        â”‚
â”‚    updatedAt: ISODate("2024-01-15T10:30:00Z"),        â”‚
â”‚    activatedAt: ISODate("2024-01-15T10:30:00Z"),      â”‚
â”‚                                                          â”‚
â”‚    // Metadata                                          â”‚
â”‚    notes: "Auto-pay enabled",                          â”‚
â”‚    cancellationReason: null,                           â”‚
â”‚    downgradedFrom: null                                â”‚
â”‚  }                                                       â”‚
â”‚                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

RELATIONSHIP DIAGRAM:

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Users   â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
         â”‚ 1:1
         â”‚
         â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ OrganizerSubscriptions   â”‚ â† CRM Features Here!
    â”‚ (New Collection)         â”‚   (crmAccess, leadCapture,
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    phoneNumbers flags)
         â”‚ 1:N
         â”‚
         â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   Leads         â”‚ â† New: Lead management
    â”‚ (Created by CRM)â”‚   (Accessible for PROF+)
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ 1:N
         â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ LeadPhoneNumbers     â”‚ â† New: Store phone details
    â”‚ (CRM Feature)        â”‚   (Visible for PROF+)
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## API Endpoint Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              SUBSCRIPTION MANAGEMENT ENDPOINTS                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

1. GET /api/subscriptions/plans
   â”œâ”€ No authentication needed
   â”œâ”€ Returns all 5 plans
   â””â”€ Response: { plans: [...5 plans with features] }

2. POST /api/subscriptions/create-order
   â”œâ”€ Requires JWT auth
   â”œâ”€ Input: { planType: "PROFESSIONAL", skipTrial: false }
   â”œâ”€ Razorpay API call
   â””â”€ Response: { order: {...}, keyId: "..." }

3. POST /api/subscriptions/verify-payment
   â”œâ”€ Requires JWT auth
   â”œâ”€ Input: { razorpay_order_id, razorpay_payment_id, razorpay_signature, planType }
   â”œâ”€ Verifies signature (HMAC-SHA256)
   â”œâ”€ Creates subscription in DB
   â”œâ”€ Sets feature flags based on plan
   â””â”€ Response: { success: true, subscription: {...} }

4. POST /api/subscriptions/webhook  â† Razorpay calls this
   â”œâ”€ No JWT auth (uses Razorpay signature)
   â”œâ”€ Verifies webhook signature
   â”œâ”€ Handles 7 event types:
   â”‚  â”œâ”€ payment.authorized
   â”‚  â”œâ”€ payment.failed
   â”‚  â”œâ”€ subscription.activated
   â”‚  â”œâ”€ subscription.charged
   â”‚  â”œâ”€ subscription.cancelled
   â”‚  â”œâ”€ subscription.paused
   â”‚  â””â”€ order.paid
   â”œâ”€ Updates subscription status
   â””â”€ Sends notifications

5. GET /api/subscriptions/verify-crm-access
   â”œâ”€ Requires JWT auth
   â”œâ”€ Checks user's subscription plan
   â”œâ”€ Returns feature flags:
   â”‚  â”œâ”€ hasCRMAccess: true/false
   â”‚  â”œâ”€ hasLeadCapture: true/false
   â”‚  â””â”€ canViewPhoneNumbers: true/false
   â””â”€ Used by CRM module to show/hide features

6. POST /api/subscriptions/check-feature-access
   â”œâ”€ Requires JWT auth
   â”œâ”€ Input: { features: ["crm", "lead_capture", "phone_numbers"] }
   â”œâ”€ Returns feature access map
   â””â”€ Used for granular permission checks
```

---

## Frontend Component Hierarchy

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       AutoPaySetup Component            â”‚
â”‚  (web/src/pages/AutoPaySetup.tsx)       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Header Section                    â”‚ â”‚
â”‚  â”‚ "Choose Your Subscription Plan"   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Plans Grid (5 columns responsive) â”‚ â”‚
â”‚  â”‚                                   â”‚ â”‚
â”‚  â”‚ [STARTER] [BASIC] [PROFESSIONAL] â”‚ â”‚
â”‚  â”‚    â†“        â†“          â†“          â”‚ â”‚
â”‚  â”‚ onClick â†’ Update      Set         â”‚ â”‚
â”‚  â”‚ selected selectedPlan = "PROF"    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Plan Details Panel (Conditional) â”‚ â”‚
â”‚  â”‚ Shows only when plan selected    â”‚ â”‚
â”‚  â”‚                                   â”‚ â”‚
â”‚  â”‚  Features:        Summary:       â”‚ â”‚
â”‚  â”‚  âœ… Feature 1     Price: â‚¹2199  â”‚ â”‚
â”‚  â”‚  âœ… Feature 2     Trips: 15     â”‚ â”‚
â”‚  â”‚  âœ… CRM Access    CRM: âœ…       â”‚ â”‚
â”‚  â”‚  (Dynamic from    Leads: âœ…     â”‚ â”‚
â”‚  â”‚   selected plan)  Phone: âœ…     â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Payment Section                   â”‚ â”‚
â”‚  â”‚ â€¢ Payment method selection        â”‚ â”‚
â”‚  â”‚ â€¢ Terms acceptance               â”‚ â”‚
â”‚  â”‚ â€¢ Submit button:                 â”‚ â”‚
â”‚  â”‚   "Complete Payment - â‚¹2199"     â”‚ â”‚
â”‚  â”‚   (Price from selectedPlan)      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Razorpay Modal (when button       â”‚ â”‚
â”‚  â”‚  clicked - external library)      â”‚ â”‚
â”‚  â”‚                                   â”‚ â”‚
â”‚  â”‚ Order Amount: 219900 paise        â”‚ â”‚
â”‚  â”‚ Plan: PROFESSIONAL                â”‚ â”‚
â”‚  â”‚ [Payment Gateway]                 â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Security & Validation Flow

```
                    Payment Request
                          â”‚
                          â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Frontend Validation            â”‚
        â”‚ â€¢ Terms accepted?              â”‚
        â”‚ â€¢ Plan selected?               â”‚
        â”‚ â€¢ Payment method chosen?       â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Create Order (Backend)         â”‚
        â”‚ â€¢ Verify JWT token             â”‚
        â”‚ â€¢ Check user role              â”‚
        â”‚ â€¢ Validate plan exists         â”‚
        â”‚ â€¢ Create Razorpay order        â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Razorpay Gateway               â”‚
        â”‚ â€¢ Process payment              â”‚
        â”‚ â€¢ Generate signature           â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Verify Payment (Backend)       â”‚
        â”‚ â€¢ Verify JWT token             â”‚
        â”‚ â€¢ Validate plan type           â”‚
        â”‚ â€¢ Verify Razorpay signature    â”‚
        â”‚   (HMAC-SHA256)                â”‚
        â”‚ â€¢ Check amount matches         â”‚
        â”‚ â€¢ Prevent tampering            â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                                â”‚
        â–¼ Valid                          â–¼ Invalid
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Create  â”‚                     â”‚ Reject   â”‚
    â”‚ Subs    â”‚                     â”‚ Log      â”‚
    â”‚ w/ CRM  â”‚                     â”‚ Error    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Database: Set Feature Flags â”‚
    â”‚ â€¢ crmAccess: true           â”‚
    â”‚ â€¢ leadCapture: true         â”‚
    â”‚ â€¢ phoneNumbers: true        â”‚
    â”‚ Status: active              â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â–¼
            âœ… Success
            User can now access CRM
```

---

## ğŸ¯ Summary

The subscription system implements:
1. **5-tier pricing model** with feature-based access
2. **PROFESSIONAL plan** (â‚¹2199) with CRM features
3. **Secure payment processing** with Razorpay
4. **Feature flags** for CRM, leads, phone numbers
5. **Interactive UI** for plan selection
6. **Responsive design** for all devices
7. **Complete webhook handling** for events
8. **Database verification** for feature access

**Status**: âœ… Production-ready for beta launch
